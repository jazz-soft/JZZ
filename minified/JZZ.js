!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define("JZZ",[],n):(t=t||window).JZZ&&t.JZZ.MIDI||(t.JZZ=n())}(this,function(){var D,L,n,i,t="undefined"==typeof window?global:window,q="1.7.8",G=Date.now||function(){return(new Date).getTime()},j=G(),z="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return G()-j},V=function(t){setTimeout(t,0)};function U(){}function a(t){return"function"==typeof t}function e(){(this._orig=this)._ready=!1,this._queue=[],this._log=[]}function W(t,n){this._bad?a(n)&&n.apply(this,[new Error(this._err())]):a(t)&&t.apply(this,[this])}function Z(t,n){this._bad?t._crash(this._err()):setTimeout(function(){t._resume()},n)}function o(t){this._bad&&t._break(this._err()),t._resume()}function J(t,e,r){t[r]=function(){var t=arguments,n=e._image();return this._push(o,[n]),n[r].apply(n,t)}}function X(t){this._bad||(a(t)?t.apply(this):console.log(t))}function H(t){this._bad&&(a(t)?t.apply(this):console.log(t))}function Q(t){this._bad?t._crash(this._err()):(this._break("Closed"),t._resume())}function K(t){if(t.length){var n,e=t.shift();t.length&&(n=this)._slip(H,[function(){K.apply(n,[t])}]);try{this._repair(),e.apply(this)}catch(t){this._break(t.toString())}}else this._break()}function Y(t,n){for(var e=0;e<t.length;e++)if(t[e]===n)return;t.push(n)}function $(t,n){for(var e=0;e<t.length;e++)if(t[e]===n)return void t.splice(e,1)}function r(){e.apply(this)}function s(t,n){for(var e in t)t.hasOwnProperty(e)&&n.call(this,e)}function tt(n,e,r){if(void 0===e)return tt(n,[],[]);if(n instanceof Object){for(var i,t=0;t<e.length;t++)if(e[t]===n)return r[t];return i=n instanceof Array?[]:{},e.push(n),r.push(i),s(n,function(t){i[t]=tt(n[t],e,r)}),i}return n}e.prototype._exec=function(){for(;this._ready&&this._queue.length;){var t=this._queue.shift();t[0].apply(this,t[1])}},e.prototype._push=function(t,n){this._queue.push([t,n]),e.prototype._exec.apply(this)},e.prototype._slip=function(t,n){this._queue.unshift([t,n])},e.prototype._pause=function(){this._ready=!1},e.prototype._resume=function(){this._ready=!0,e.prototype._exec.apply(this)},e.prototype._break=function(t){this._orig._bad=!0,this._orig._log.push(t||"Unknown JZZ error")},e.prototype._repair=function(){this._orig._bad=!1},e.prototype._crash=function(t){this._break(t),this._resume()},e.prototype._err=function(){return this._log[this._log.length-1]},e.prototype.log=function(){return tt(this._log)},e.prototype._dup=function(){function t(){}t.prototype=this._orig;var n=new t;return n._ready=!1,n._queue=[],n},e.prototype._image=function(){return this._dup()},e.prototype._thenable=function(){if(this.then)return this;function t(){}var e=this,n=(t.prototype=e,new t);return n.then=function(t,n){return e._push(W,[t,n]),this},n},e.prototype.wait=function(t){if(!t)return this;var n=this._image();return this._push(Z,[n,t]),n._thenable()},e.prototype.and=function(t){return this._push(X,[t]),this._thenable()},e.prototype.or=function(t){return this._push(H,[t]),this._thenable()},e.prototype._info={},e.prototype.info=function(){var t=tt(this._orig._info);return void 0===t.engine&&(t.engine="none"),void 0===t.sysex&&(t.sysex=!0),t},e.prototype.name=function(){return this.info().name},e.prototype.close=function(){var t=new e;return this._close&&this._push(this._close,[]),this._push(Q,[t]),t._thenable()},(r.prototype=new e)._info={name:"JZZ.js",ver:q,version:q,inputs:[],outputs:[]};var u,nt=[],et=[],rt=[],it=[],ot={},st={};function ut(){var t,n;for(u._info.engine=f._type,u._info.version=f._version,u._info.sysex=f._sysex,u._info.inputs=[],u._info.outputs=[],nt=[],et=[],f._allOuts={},f._allIns={},t=0;t<f._outs.length;t++)n=f._outs[t],ot[n.name]||((n.engine=f)._allOuts[n.name]=n,u._info.outputs.push({id:n.name,name:n.name,manufacturer:n.manufacturer,version:n.version,engine:f._type}),nt.push(n));for(t=0;t<wt._outs.length;t++)n=wt._outs[t],ot[n.name]||(u._info.outputs.push({id:n.name,name:n.name,manufacturer:n.manufacturer,version:n.version,engine:n.type}),nt.push(n));for(t=0;t<f._ins.length;t++)n=f._ins[t],st[n.name]||((n.engine=f)._allIns[n.name]=n,u._info.inputs.push({id:n.name,name:n.name,manufacturer:n.manufacturer,version:n.version,engine:f._type}),et.push(n));for(t=0;t<wt._ins.length;t++)n=wt._ins[t],st[n.name]||(u._info.inputs.push({id:n.name,name:n.name,manufacturer:n.manufacturer,version:n.version,engine:n.type}),et.push(n));if(u._watcher&&u._watcher._handles.length){var e=function(t,n,e,r){if(function(t,n,e,r){var i;if(t.length!=e.length||n.length!=r.length)return 1;for(i=0;i<t.length;i++)if(t[i].name!=e[i].name)return 1;for(i=0;i<n.length;i++)if(n[i].name!=r[i].name)return 1;return}(t,n,e,r)){var i,o=[],s=[],u=[],a=[],c={};for(i=0;i<t.length;i++)c[t[i].name]=!0;for(i=0;i<e.length;i++)c[e[i].name]||o.push(e[i]);for(c={},i=0;i<e.length;i++)c[e[i].name]=!0;for(i=0;i<t.length;i++)c[t[i].name]||u.push(t[i]);for(c={},i=0;i<n.length;i++)c[n[i].name]=!0;for(i=0;i<r.length;i++)c[r[i].name]||s.push(r[i]);for(c={},i=0;i<r.length;i++)c[r[i].name]=!0;for(i=0;i<n.length;i++)c[n[i].name]||a.push(n[i]);return{inputs:{added:o,removed:u},outputs:{added:s,removed:a}}}}(it,rt,u._info.inputs,u._info.outputs);if(e){for(L=0;L<e.inputs.removed.length;L++)(n=f._inMap[e.inputs.removed[L].name])&&n._closeAll();for(L=0;L<e.outputs.removed.length;L++)(n=f._outMap[e.outputs.removed[L].name])&&n._closeAll();var r=e;for(D=0;D<u._watcher._handles.length;D++)u._watcher._handles[D].apply(u,[r])}}it=u._info.inputs,rt=u._info.outputs}function at(){this._bad||f._refresh(this)}function ct(t,n){(t=a(t)?t(n):t)instanceof Array||(t=[t]);for(var e,r=[],i=[],o=n.slice(),s=r,u=0;u<t.length;u++)if(void 0===t[u])s=i;else if(t[u]instanceof RegExp)for(e=0;e<o.length;e++)t[u].test(o[e].name)&&(s.push(o[e]),o.splice(e,1),e--);else for(e=0;e<o.length;e++)(t[u]+""==e+""||t[u]===o[e].name||t[u]instanceof Object&&t[u].name===o[e].name)&&(s.push(o[e]),o.splice(e,1),e--);return s==r?r:r.concat(o).concat(i)}function ht(t,n){n=n instanceof RegExp?"Port matching "+n+" not found":n instanceof Object||void 0===n?"Port not found":'Port "'+n+'" not found';t._crash(n)}function ft(t,n){if(this._bad)t._crash(this._err());else{var e=ct(n,nt);if(e.length){for(var r=0;r<e.length;r++)e[r]=function(t){return function(){t.engine._openOut(this,t.name)}}(e[r]);t._slip(K,[e]),t._resume()}else ht(t,n)}}function pt(t,n){if(this._bad)t._crash(this._err());else{var e=ct(n,et);if(e.length){for(var r=0;r<e.length;r++)e[r]=function(t){return function(){t.engine._openIn(this,t.name)}}(e[r]);t._slip(K,[e]),t._resume()}else ht(t,n)}}function lt(t,n){this._bad?t._crash():(t._slip(Mt,[n]),t._resume())}function c(){e.apply(this),this._handles=[],this._outs=[]}function dt(t){this._bad||this._receive(t)}function mt(t){return t.isMidi2?new A(t):d.apply(null,arguments)}function gt(t){this._emit(t)}function _t(t){a(t)?Y(this._orig._handles,t):Y(this._orig._outs,t)}function vt(t){void 0===t?(this._orig._handles=[],this._orig._outs=[]):a(t)?$(this._orig._handles,t):$(this._orig._outs,t)}function yt(t,n){this._orig._mpe||(this._orig._mpe=new Mn),this._orig._mpe.setup(t,n)}function bt(t){if(t!=parseInt(t)||t<0||15<t)throw RangeError("Bad channel value (must not be less than 0 or more than 15): "+t)}function h(t){e.apply(this),this._sink=t}function Ct(){e.apply(this),this._handles=[],J(this,u,"refresh"),J(this,u,"openMidiOut"),J(this,u,"openMidiIn"),J(this,u,"onChange"),J(this,u,"close")}function Mt(t){a(t)&&(this._orig._handles.length||f._watch(),Y(this._orig._handles,t))}function xt(t){void 0===t?this._orig._handles=[]:$(this._orig._handles,t),this._orig._handles.length||f._unwatch()}r.prototype.refresh=function(){return this._push(at,[]),this._thenable()},r.prototype.openMidiOut=function(t){var n=new c;return this._push(at,[]),this._push(ft,[n,t]),n._thenable()},r.prototype._openMidiOutNR=function(t){var n=new c;return this._push(ft,[n,t]),n._thenable()},r.prototype.openMidiIn=function(t){var n=new c;return this._push(at,[]),this._push(pt,[n,t]),n._thenable()},r.prototype._openMidiInNR=function(t){var n=new c;return this._push(pt,[n,t]),n._thenable()},r.prototype.onChange=function(t){this._orig._watcher||(this._orig._watcher=new Ct);var n=this._orig._watcher._image();return this._push(lt,[n,t]),n._thenable()},r.prototype._close=function(){f._close()},(c.prototype=new e)._filter=function(t){var n,e;return this._orig._mpe&&(e=0,this._handles&&this._handles.length&&(e=this._handles.length,n=this._handles[0]),this._outs&&this._outs.length&&(e=this._outs.length,n=this._outs[0]),1!=e||n._mpe||(t=this._orig._mpe.filter(t))),t},c.prototype._receive=function(t){this._emit(this._filter(t))},c.prototype.send=function(){return this._push(dt,[mt.apply(null,arguments)]),this._thenable()},c.prototype.note=function(t,n,e,r){return this.noteOn(t,n,e),void 0===this._ch&&void 0===this._master?0<r&&this.wait(r).noteOff(t,n):0<e&&this.wait(e).noteOff(t),this._thenable()},c.prototype._emit=function(t){for(var n,e=0;e<this._handles.length;e++)n=mt(t),this._handles[e].apply(this,[n._stamp(this)]);for(e=0;e<this._outs.length;e++)(n=mt(t))._stamped(this._outs[e])||this._outs[e].send(n._stamp(this))},c.prototype.emit=function(t){return this._push(gt,[t]),this._thenable()},c.prototype.connect=function(t){return this._push(_t,[t]),this._thenable()},c.prototype.disconnect=function(t){return this._push(vt,[t]),this._thenable()},c.prototype.connected=function(){return this._orig._handles.length+this._orig._outs.length},c.prototype._image=function(){var t=this._dup();return t._gr=this._gr,t._ch=this._ch,t._sxid=this._sxid,t._master=this._master,t._band=this._band,t},c.prototype._sxid=127,c.prototype.sxId=function(t){if((t=void 0===t?c.prototype._sxid:t)==this._sxid)return this._thenable();t=v(t);var n=this._image();return n._sxid=t,this._push(o,[n]),n._thenable()},c.prototype.ch=function(t){if(t==this._ch||void 0===t&&void 0===this._ch)return this._thenable();var n=this._image();return void 0!==t&&(t=g(t)),n._ch=t,n._master=void 0,n._band=void 0,this._push(o,[n]),n._thenable()},c.prototype.MIDI1=function(){var t=this._image();return t._ch=void 0,t._sxid=c.prototype._sxid,t._master=void 0,t._band=void 0,this._push(o,[t]),t._thenable()},c.prototype.MIDI2=function(){var t=this._image(),t=(t._ch=void 0,t._sxid=c.prototype._sxid,t._master=void 0,t._band=void 0,new h(t));return this._push(o,[t]),t._thenable()},c.prototype.mpe=function(t,n){if(t==this._master&&n==this._band||void 0===t&&void 0===this._master)return this._thenable();if(void 0!==t&&Mn.validate(t,n),!n)return this.ch(t);var e=this._image();return e._ch=void 0,e._master=t,e._band=n,this._push(yt,[t,n]),this._push(o,[e]),e._thenable()},(h.prototype=new e)._sxid=c.prototype._sxid,h.prototype._receive=function(t){this._sink._receive(t)},h.prototype.send=function(){return this._push(dt,[function(t){return t.isMidi&&!t.isMidi2?new d(t):A.apply(null,arguments)}.apply(null,arguments)]),this._thenable()},h.prototype._image=c.prototype._image,h.prototype.connect=function(t){return this._sink.connect(t),this._push(o,[this._sink]),this._thenable()},h.prototype.disconnect=function(t){return this._sink.disconnect(t),this._push(o,[this._sink]),this._thenable()},h.prototype.connected=function(){return this._sink.connected()},h.prototype.sxId=c.prototype.sxId,h.prototype.ch=c.prototype.ch,h.prototype.gr=function(t){if(t==this._gr||void 0===t&&void 0===this._gr)return this._thenable();var n=this._image();return void 0!==t&&(t=v(t)),n._gr=t,this._push(o,[n]),n._thenable()},h.prototype.MIDI1=function(){var t=this._sink._image();return this._push(o,[t]),t._thenable()},h.prototype.MIDI2=function(){var t=this._image();return t._gr=void 0,t._ch=void 0,t._sxid=c.prototype._sxid,this._push(o,[t]),t._thenable()},(Ct.prototype=new e).connect=function(t){return this._push(Mt,[t]),this._thenable()},Ct.prototype.disconnect=function(t){return this._push(xt,[t]),this._thenable()};var St,Tt,f={_outs:[],_ins:[]},wt={_outs:[],_ins:[]};function It(){if("undefined"!=typeof module&&module.exports){var t=require("jazz-midi");if(t)return n=t,f._type="node",f._main=n,f._pool=[],f._newPlugin=function(){return new n.MIDI},void Rt()}var n;this._break()}function At(){var n,t=document.createElement("div"),t=(t.style.visibility="hidden",document.body.appendChild(t),document.createElement("object"));if(t.style.visibility="hidden",t.style.width="0px",t.style.height="0px",t.classid="CLSID:1ACE1618-1C7D-4561-AEE1-34842AA85E90",t.type="audio/x-jazz",document.body.appendChild(t),t.isJazz)return n=t,f._type="plugin",f._main=n,f._pool=[n],f._newPlugin=function(){var t=document.createElement("object");return t.style.visibility="hidden",t.style.width="0px",n.style.height="0px",t.classid="CLSID:1ACE1618-1C7D-4561-AEE1-34842AA85E90",t.type="audio/x-jazz",document.body.appendChild(t),t.isJazz?t:void 0},void Rt();this._break()}function Bt(){if("undefined"!=typeof navigator&&navigator.requestMIDIAccess){St=navigator,Tt=navigator.requestMIDIAccess;try{-1!=Tt.toString().indexOf("JZZ(")&&(Tt=void 0)}catch(t){}}}function Pt(){var n;if(Bt(),Tt)return n=this,Tt.call(St,{}).then(function(t){Dt(t),n._resume()},function(t){n._crash(t)}),void this._pause();this._break()}function Ft(){var n;if(Bt(),Tt)return n=this,Tt.call(St,{sysex:!0}).then(function(t){Dt(t,!0),n._resume()},function(t){n._crash(t)}),void this._pause();this._break()}function Et(){var r,o,s=this;function u(t){r=!0;var n,e,t=t.detail;if(!t){if(!(o=o||document.getElementById("jazz-midi-msg")))return;try{t=JSON.parse(o.innerText)}catch(t){}o.innerText=""}function i(){for(var t=0;t<this.clients.length;t++)this._close(this.clients[t])}document.removeEventListener("jazz-midi-msg",u),"version"===t[0]?(n=o,t=t[2],f._type="extension",f._version=t,f._sysex=!0,f._pool=[],f._outs=[],f._ins=[],f._inArr=[],f._outArr=[],f._inMap={},f._outMap={},f._outsW=[],f._insW=[],f.refreshClients=[],f._msg=n,f._newPlugin=function(){var t={id:f._pool.length};f._pool.push(t),t.id?document.dispatchEvent(new CustomEvent("jazz-midi",{detail:["new"]})):t.ready=!0},f._newPlugin(),f._refresh=function(t){f.refreshClients.push(t),t._pause(),V(function(){document.dispatchEvent(new CustomEvent("jazz-midi",{detail:["refresh"]}))})},f._openOut=function(t,n){var e,r=f._outMap[n];r||(f._pool.length<=f._outArr.length&&f._newPlugin(),e=f._pool[f._outArr.length],((r={name:n,clients:[],info:{name:n,manufacturer:f._allOuts[n].manufacturer,version:f._allOuts[n].version,type:"MIDI-out",sysex:f._sysex,engine:f._type},_start:function(){document.dispatchEvent(new CustomEvent("jazz-midi",{detail:["openout",e.id,n]}))},_close:function(t){f._closeOut(t)},_closeAll:i,_receive:function(t){t.length&&((t=t.slice()).splice(0,0,"play",e.id),document.dispatchEvent(new CustomEvent("jazz-midi",{detail:t})))}}).plugin=e).output=r,f._outArr.push(r),f._outMap[n]=r),Y((t._orig._impl=r).clients,t._orig),t._info=r.info,t._receive=function(t){r._receive(t)},t._close=function(){r._close(this)},r.open||(t._pause(),r.plugin.ready&&r._start())},f._openIn=function(t,n){var e,r=f._inMap[n];r||(f._pool.length<=f._inArr.length&&f._newPlugin(),e=f._pool[f._inArr.length],((r={name:n,clients:[],info:{name:n,manufacturer:f._allIns[n].manufacturer,version:f._allIns[n].version,type:"MIDI-in",sysex:f._sysex,engine:f._type},_start:function(){document.dispatchEvent(new CustomEvent("jazz-midi",{detail:["openin",e.id,n]}))},_close:function(t){f._closeIn(t)},_closeAll:i}).plugin=e).input=r,f._inArr.push(r),f._inMap[n]=r),Y((t._orig._impl=r).clients,t._orig),t._info=r.info,t._close=function(){r._close(this)},r.open||(t._pause(),r.plugin.ready&&r._start())},f._closeOut=function(t){var n=t._impl;$(n.clients,t._orig),!n.clients.length&&n.open&&(n.open=!1,document.dispatchEvent(new CustomEvent("jazz-midi",{detail:["closeout",n.plugin.id]})))},f._closeIn=function(t){var n=t._impl;$(n.clients,t._orig),!n.clients.length&&n.open&&(n.open=!1,document.dispatchEvent(new CustomEvent("jazz-midi",{detail:["closein",n.plugin.id]})))},f._close=function(){f._unwatch()},f._watch=function(){f._insW=f._ins,f._outsW=f._outs,e=setInterval(function(){document.dispatchEvent(new CustomEvent("jazz-midi",{detail:["refresh"]}))},250)},f._unwatch=function(){clearInterval(e),e=void 0},document.addEventListener("jazz-midi-msg",function(t){var n,e,r,i=t.detail?[t.detail]:void 0;if(!i)for(i=f._msg.innerText.split("\n"),f._msg.innerText="",n=0;n<i.length;n++)try{i[n]=JSON.parse(i[n])}catch(t){i[n]=[]}for(n=0;n<i.length;n++){var o=i[n];if(o.length)if("refresh"===o[0]){if(o[1].ins){for(e=0;e<o[1].ins.length;e++)o[1].ins[e].type=f._type;f._ins=o[1].ins}if(o[1].outs){for(e=0;e<o[1].outs.length;e++)o[1].outs[e].type=f._type;f._outs=o[1].outs}for(ut(),e=0;e<f.refreshClients.length;e++)f.refreshClients[e]._resume();f.refreshClients=[]}else if("version"===o[0]){var s=f._pool[o[1]];s&&(s.ready=!0,s.input&&s.input._start(),s.output&&s.output._start())}else if("openout"===o[0]){if(r=f._pool[o[1]].output)if(o[2]==r.name){if(r.open=!0,r.clients)for(e=0;e<r.clients.length;e++)r.clients[e]._resume()}else if(r.clients)for(e=0;e<r.clients.length;e++)r.clients[e]._crash()}else if("openin"===o[0]){if(r=f._pool[o[1]].input)if(o[2]==r.name){if(r.open=!0,r.clients)for(e=0;e<r.clients.length;e++)r.clients[e]._resume()}else if(r.clients)for(e=0;e<r.clients.length;e++)r.clients[e]._crash()}else if("midi"===o[0]&&(r=f._pool[o[1]].input)&&r.clients)for(e=0;e<r.clients.length;e++){var u=d(o.slice(3));r.clients[e]._emit(u)}}}),s._resume()):s._crash()}this._pause();try{document.addEventListener("jazz-midi-msg",u),document.dispatchEvent(new Event("jazz-midi"))}catch(t){}setTimeout(function(){r||s._crash()},50)}function Ot(){this._pause();var t=this;V(function(){t._crash()})}function Nt(t){for(var n=[],e=function(t){var n=["node","extension","plugin","webmidi"];if(!t||!t.engine)return n;var e,r,i,o=t.engine instanceof Array?t.engine:[t.engine],s={},u=[],a=[];for(i=0;i<o.length;i++){var c=o[i].toString().toLowerCase();s[c]||(s[c]=!0,"none"===c&&(e=!0),((r="etc"!==c&&void 0!==c?r:!0)?a:u).push(c),$(n,c))}(r||u.length||a.length)&&(e=!1);return e?[]:u.concat(r?n:a)}(t),r=0;r<e.length;r++)"webmidi"==e[r]?(t&&!0===t.sysex&&n.push(Ft),t&&!0===t.sysex&&!0!==t.degrade||n.push(Pt)):"node"==e[r]?(n.push(It),n.push(Ot)):"extension"==e[r]?n.push(Et):"plugin"==e[r]&&n.push(At);return n.push(kt),n}function kt(){f._type="none",f._version=q,f._sysex=!0,f._outs=[],f._ins=[],f._refresh=function(){ut()},f._watch=U,f._unwatch=U,f._close=U}function Rt(){var t;function o(){for(var t=0;t<this.clients.length;t++)this._close(this.clients[t])}f._inArr=[],f._outArr=[],f._inMap={},f._outMap={},f._outsW=[],f._insW=[],f._version=f._main.version,f._sysex=!0,f._refresh=function(){var t,n;for(f._outs=[],f._ins=[],t=0;(n=f._main.MidiOutInfo(t)).length;t++)f._outs.push({type:f._type,name:n[0],manufacturer:n[1],version:n[2]});for(t=0;(n=f._main.MidiInInfo(t)).length;t++)f._ins.push({type:f._type,name:n[0],manufacturer:n[1],version:n[2]});ut()},f._openOut=function(t,n){var e=f._outMap[n];if(e||(f._pool.length<=f._outArr.length&&f._pool.push(f._newPlugin()),e={name:n,clients:[],info:{name:n,manufacturer:f._allOuts[n].manufacturer,version:f._allOuts[n].version,type:"MIDI-out",sysex:f._sysex,engine:f._type},_close:function(t){f._closeOut(t)},_closeAll:o,_receive:function(t){t.length&&this.plugin.MidiOutRaw(t.slice())}},r=f._pool[f._outArr.length],e.plugin=r,f._outArr.push(e),f._outMap[n]=e),!e.open){var r=e.plugin.MidiOutOpen(n);if(r!==n)return r&&e.plugin.MidiOutClose(),void t._break();e.open=!0}Y((t._orig._impl=e).clients,t._orig),t._info=e.info,t._receive=function(t){e._receive(t)},t._close=function(){e._close(this)}},f._openIn=function(t,n){var e,r=f._inMap[n];if(r||(f._pool.length<=f._inArr.length&&f._pool.push(f._newPlugin()),(r={name:n,clients:[],info:{name:n,manufacturer:f._allIns[n].manufacturer,version:f._allIns[n].version,type:"MIDI-in",sysex:f._sysex,engine:f._type},_close:function(t){f._closeIn(t)},_closeAll:o,handle:function(t,n){for(var e=0;e<this.clients.length;e++){var r=d(n);this.clients[e]._emit(r)}}}).onmidi=(e=r,function(t,n){e.handle(t,n)}),i=f._pool[f._inArr.length],r.plugin=i,f._inArr.push(r),f._inMap[n]=r),!r.open){var i=r.plugin.MidiInOpen(n,r.onmidi);if(i!==n)return i&&r.plugin.MidiInClose(),void t._break();r.open=!0}Y((t._orig._impl=r).clients,t._orig),t._info=r.info,t._close=function(){r._close(this)}},f._closeOut=function(t){var n=t._impl;$(n.clients,t._orig),!n.clients.length&&n.open&&(n.open=!1,n.plugin.MidiOutClose())},f._closeIn=function(t){var n=t._impl;$(n.clients,t._orig),!n.clients.length&&n.open&&(n.open=!1,n.plugin.MidiInClose())},f._close=function(){for(var t=0;t<f._inArr.length;t++)f._inArr[t].open&&f._inArr[t].plugin.MidiInClose();f._unwatch()},f._watch=function(){t=t||setInterval(function(){f._refresh()},250)},f._unwatch=function(){t&&clearInterval(t),t=void 0}}function Dt(t,n){var e;function o(){for(var t=0;t<this.clients.length;t++)this._close(this.clients[t])}f._type="webmidi",f._version=43,f._sysex=!!n,f._access=t,f._inMap={},f._outMap={},f._outsW=[],f._insW=[],f._refresh=function(){f._outs=[],f._ins=[],f._access.outputs.forEach(function(t){f._outs.push({type:f._type,name:t.name,manufacturer:t.manufacturer,version:t.version})}),f._access.inputs.forEach(function(t){f._ins.push({type:f._type,name:t.name,manufacturer:t.manufacturer,version:t.version})}),ut()},f._openOut=function(t,n){var e,r=(r=f._outMap[n])||{name:n,clients:[],info:{name:n,manufacturer:f._allOuts[n].manufacturer,version:f._allOuts[n].version,type:"MIDI-out",sysex:f._sysex,engine:f._type},_close:function(t){f._closeOut(t)},_closeAll:o,_receive:function(t){r.dev&&t.length&&this.dev.send(t.slice())}};f._access.outputs.forEach(function(t){t.name===n&&(e=t)}),e?(r.dev=e,f._outMap[n]=r,Y((t._orig._impl=r).clients,t._orig),t._info=r.info,t._receive=function(t){r._receive(t)},t._close=function(){r._close(this)},r.dev.open&&(t._pause(),r.dev.open().then(function(){t._resume()},function(){t._crash()}))):t._break()},f._openIn=function(t,n){var e,r,i=(i=f._inMap[n])||{name:n,clients:[],info:{name:n,manufacturer:f._allIns[n].manufacturer,version:f._allIns[n].version,type:"MIDI-in",sysex:f._sysex,engine:f._type},_close:function(t){f._closeIn(t)},_closeAll:o,handle:function(t){for(var n=0;n<this.clients.length;n++){var e=d([].slice.call(t.data));this.clients[n]._emit(e)}}};f._access.inputs.forEach(function(t){t.name===n&&(e=t)}),e?(i.dev=e,i.dev.onmidimessage=(r=i,function(t){r.handle(t)}),f._inMap[n]=i,Y((t._orig._impl=i).clients,t._orig),t._info=i.info,t._close=function(){i._close(this)},i.dev.open&&(t._pause(),i.dev.open().then(function(){t._resume()},function(){t._crash()}))):t._break()},f._closeOut=function(t){var n=t._impl;$(n.clients,t._orig),n.clients.length||(n.dev&&n.dev.close&&n.dev.close(),n.dev=void 0)},f._closeIn=function(t){var n=t._impl;$(n.clients,t._orig),n.clients.length||(n.dev&&(n.dev.onmidimessage=null,n.dev.close&&n.dev.close()),n.dev=void 0)},f._close=function(){f._unwatch()},f._watch=function(){f._access.onstatechange=function(){e=!0,V(function(){e&&(f._refresh(),e=!1)})}},f._unwatch=function(){f._access.onstatechange=void 0}}var p=function(t){return u||(t=t,(u=new r)._options=t,u._push(K,[Nt(t)]),u.refresh(),u._resume()),u._thenable()};function l(){var t=this instanceof l?this:new l;return l.prototype.reset.apply(t,arguments),t}function Lt(){29.97==this.type&&!this.second&&this.frame<2&&this.minute%10&&(this.frame=2)}function qt(t){return[[24,25,29.97,30][t[7]>>1&3],(1&t[7])<<4|t[6],t[5]<<4|t[4],t[3]<<4|t[2],t[1]<<4|t[0]]}function Gt(t){for(var n,e=[],r=0;r<t.length;r++)e[r]=(n=r?t[r]:31&t[r])<10?"0"+n:n;return e.join(":")}function d(n){var e=this instanceof d?this:new d;if(n instanceof d)return e._from=n._from.slice(),s(n,function(t){"_from"!=t&&(e[t]=n[t])}),e;if(e._from=[],void 0===n)return e;for(var t=n instanceof Array?n:arguments,r=0;r<t.length;r++)i=t[r],1==r&&(128<=e[0]&&e[0]<=175&&(i=d.noteValue(i)),192<=e[0]&&e[0]<=207&&(i=d.programValue(i))),(i!=parseInt(i)||i<0||255<i)&&Ut(t[r]),e.push(i);return e}(p.JZZ=p).version=q,p.info=function(){return r.prototype.info()},p.Widget=function(n){var e=new c;return n instanceof Object&&s(n,function(t){e[t]=n[t]}),e._resume(),e},r.prototype.Widget=p.Widget,p.addMidiIn=function(t,n){var e=tt(n._info||{});return e.name=t,e.type=e.type||"javascript",e.manufacturer=e.manufacturer||"virtual",e.version=e.version||"0.0",p.lib.registerMidiIn(t,{_info:function(){return e},_openIn:function(t){t._pause(),t._info=tt(e),t._close=function(){n.disconnect(t)},n.connect(t),t._resume()}})},r.prototype.addMidiIn=p.addMidiIn,p.addMidiOut=function(t,n){var e=tt(n._info||{});return e.name=t,e.type=e.type||"javascript",e.manufacturer=e.manufacturer||"virtual",e.version=e.version||"0.0",p.lib.registerMidiOut(t,{_info:function(){return e},_openOut:function(t){t._pause(),t._info=tt(e),t._close=function(){t.disconnect()},_t.apply(t,[n]),t._resume()}})},r.prototype.addMidiOut=p.addMidiOut,p.maskMidiIn=function(t){st[t]=!0},r.prototype.maskMidiIn=p.maskMidiIn,p.unmaskMidiIn=function(t){delete st[t]},r.prototype.unmaskMidiIn=p.unmaskMidiIn,p.maskMidiOut=function(t){ot[t]=!0},r.prototype.maskMidiOut=p.maskMidiOut,p.unmaskMidiOut=function(t){delete ot[t]},r.prototype.unmaskMidiOut=p.unmaskMidiOut,l.prototype.reset=function(t){if(t instanceof l)return this.setType(t.getType()),this.setHour(t.getHour()),this.setMinute(t.getMinute()),this.setSecond(t.getSecond()),this.setFrame(t.getFrame()),this.setQuarter(t.getQuarter()),this;var n=t instanceof Array?t:arguments;return this.setType(n[0]),this.setHour(n[1]),this.setMinute(n[2]),this.setSecond(n[3]),this.setFrame(n[4]),this.setQuarter(n[5]),this},l.prototype.isFullFrame=function(){return 0==this.quarter||4==this.quarter},l.prototype.getType=function(){return this.type},l.prototype.getHour=function(){return this.hour},l.prototype.getMinute=function(){return this.minute},l.prototype.getSecond=function(){return this.second},l.prototype.getFrame=function(){return this.frame},l.prototype.getQuarter=function(){return this.quarter},l.prototype.setType=function(t){if(void 0===t||24==t)this.type=24;else if(25==t)this.type=25;else if(29.97==t)this.type=29.97,Lt.apply(this);else{if(30!=t)throw RangeError("Bad SMPTE frame rate: "+t);this.type=30}return this.frame>=this.type&&(this.frame=this.type-1),this},l.prototype.setHour=function(t){if((t=void 0===t?0:t)!=parseInt(t)||t<0||24<=t)throw RangeError("Bad SMPTE hours value: "+t);return this.hour=t,this},l.prototype.setMinute=function(t){if((t=void 0===t?0:t)!=parseInt(t)||t<0||60<=t)throw RangeError("Bad SMPTE minutes value: "+t);return this.minute=t,Lt.apply(this),this},l.prototype.setSecond=function(t){if((t=void 0===t?0:t)!=parseInt(t)||t<0||60<=t)throw RangeError("Bad SMPTE seconds value: "+t);return this.second=t,Lt.apply(this),this},l.prototype.setFrame=function(t){if((t=void 0===t?0:t)!=parseInt(t)||t<0||t>=this.type)throw RangeError("Bad SMPTE frame number: "+t);return this.frame=t,Lt.apply(this),this},l.prototype.setQuarter=function(t){if((t=void 0===t?0:t)!=parseInt(t)||t<0||8<=t)throw RangeError("Bad SMPTE quarter frame: "+t);return this.quarter=t,this},l.prototype.incrFrame=function(){return this.frame++,this.frame>=this.type&&(this.frame=0,this.second++,60<=this.second&&(this.second=0,this.minute++,60<=this.minute&&(this.minute=0,this.hour=23<=this.hour?0:this.hour+1))),Lt.apply(this),this},l.prototype.decrFrame=function(){return!this.second&&2==this.frame&&29.97==this.type&&this.minute%10&&(this.frame=0),this.frame--,this.frame<0&&(this.frame=29.97==this.type?29:this.type-1,this.second--,this.second<0&&(this.second=59,this.minute--,this.minute<0&&(this.minute=59,this.hour=this.hour?this.hour-1:23))),this},l.prototype.incrQF=function(){return this.backwards=!1,this.quarter=this.quarter+1&7,0!=this.quarter&&4!=this.quarter||this.incrFrame(),this},l.prototype.decrQF=function(){return this.backwards=!0,this.quarter=this.quarter+7&7,3!=this.quarter&&7!=this.quarter||this.decrFrame(),this},l.prototype.read=function(t){return 240==(t=t instanceof d?t:d.apply(null,arguments))[0]&&127==t[1]&&1==t[3]&&1==t[4]&&247==t[9]?(this.type=[24,25,29.97,30][t[5]>>5&3],this.hour=31&t[5],this.minute=t[6],this.second=t[7],this.frame=t[8],this.quarter=0,this._=void 0,this._b=void 0,!(this._f=void 0)):241==t[0]&&void 0!==t[1]&&(n=t[1]>>4,e=15&t[1],0==n?7==this._&&(7==this._f&&(this.reset(qt(this._a)),this.incrFrame()),this.incrFrame()):3==n?4==this._&&this.decrFrame():4==n?3==this._&&this.incrFrame():7==n&&0===this._&&(0===this._b&&(this.reset(qt(this._a)),this.decrFrame()),this.decrFrame()),this._a||(this._a=[]),this._a[n]=e,this._f=this._f===n-1||0==n?n:void 0,this._b=this._b===1+n||7==n?n:void 0,this._=n,this.quarter=n,!0);var n,e},l.prototype.toString=function(){return Gt([this.hour,this.minute,this.second,this.frame])},p.SMPTE=l,r.prototype.SMPTE=l,d.prototype=[],(d.prototype.constructor=d).prototype.isMidi=function(){return 1};var m={};function jt(t){if(t!=parseFloat(t))throw TypeError("Not a number: "+t)}function zt(){}d.noteValue=function(t){return void 0===t?void 0:m[t.toString().toLowerCase()]},d.programValue=function(t){return t},d.octaveValue=function(t){var n=m[t.toString().toLowerCase()];return void 0===(n=void 0===n?m[t.toString().toLowerCase()+"1"]:n)?void 0:n%12},d.freq=function(t,n){return jt(n=void 0===n?440:n),t!=parseFloat(t)&&(t=b(t)),n*Math.pow(2,(t-69)/12)},d.shift=function(t,n){return void 0===n&&(n=440),jt(t),jt(n),12*Math.log2(t/n)},d.midi=function(t,n){return t!=parseFloat(t)?b(t):d.shift(t,n)+69},d.to7b=function(t){return jt(t),t<=0?0:1<=t?127:Math.floor(128*t)},d.to14b=function(t){return jt(t),t<=0?0:1<=t?16383:Math.floor(16384*t)},d.to21b=function(t){return void 0===t?2097151:(jt(t),t<=0?0:(t=(Math.floor(t)<<14)+d.to14b(t-Math.floor(t)))<2097151?t:2097150)},d.to32b=function(t){return jt(t),t<=0?0:1<=t?4294967295:Math.floor(4294967296*t)},(zt.prototype=d)._sxid=127,d.sxId=function(t){if((t=void 0===t?d._sxid:t)==this._sxid)return this;t=v(t);var n=new zt;return n._ch=this._ch,n._sxid=t,n},d.ch=function(t){if(t==this._ch||void 0===t&&void 0===this._ch)return this;var n=new zt;return void 0!==t&&(t=g(t)),n._ch=t,n._sxid=this._sxid,n};var Vt={c:0,d:2,e:4,f:5,g:7,a:9,b:11,h:11};for(s(Vt,function(t){for(i=0;i<12&&!(127<(n=Vt[t]+12*i));i++)m[t+i]=n,0<(m[t+"â™®"+i]=n)&&(m[t+"b"+i]=n-1,m[t+"â™­"+i]=n-1,m[t+"bb"+i]=n-2,m[t+"â™­â™­"+i]=n-2,m[t+"ð„«"+i]=n-2),n<127&&(m[t+"#"+i]=n+1,m[t+"â™¯"+i]=n+1,m[t+"##"+i]=n+2,m[t+"â™¯â™¯"+i]=n+2,m[t+"ð„ª"+i]=n+2)}),i=0;i<128;i++)m[i]=i;function Ut(t){throw RangeError("Bad MIDI value: "+t)}function Wt(t){throw TypeError("Invalid value: "+t)}function g(t){return bt(t),parseInt(t)}function _(t){if(t!=parseInt(t)||t<0||15<t)throw RangeError("Expected a 4-bit value: "+t);return parseInt(t)}function v(t,n){return(t!=parseInt(t)||t<0||127<t)&&Ut(void 0===n?t:n),parseInt(t)}function y(t){return(t!=parseInt(t)||t<0||255<t)&&Ut(t),parseInt(t)}function Zt(t){return(t!=parseInt(t)||t<0||16383<t)&&Ut(t),parseInt(t)}function Jt(t){if(t!=parseInt(t)||t<0||65535<t)throw RangeError("Expected a 16-bit value: "+t);return parseInt(t)}function b(t){return v(d.noteValue(t),t)}function C(t){return 127&Zt(t)}function M(t){return Zt(t)>>7}function Xt(t){return[t>>14,t>>7&127,127&t]}function Ht(t,n){if(t!=parseFloat(t)&&Wt(void 0===n?t:n),t<0||1<t)throw RangeError("Out of range: "+(void 0===n?t:n));return parseFloat(t)}function Qt(t){return void 0===t||t?127:126}function Kt(e){for(var r,i=[],o={},t=(s(e,function(t){var n;if(((n=e[t])!=parseInt(n)||n<0||2097151<n)&&Ut(n),r=parseInt(n),(t=b(t))in o)throw RangeError("Duplicate MIDI value: "+t);i.push(t),o[t]=r}),i.sort(),[i.length]),n=0;n<i.length;n++)t=t.concat([i[n]],Xt(o[i[n]]));return t}function Yt(n){var e={};return s(n,function(t){e[t]=d.to21b(n[t]==parseFloat(n[t])?n[t]:b(n[t]))}),e}function $t(n){var e={};return s(n,function(t){e[t]=d.to21b(d.midi(n[t]))}),e}var tn={noteOff:function(t,n,e){return void 0===e&&(e=64),[128+g(t),b(n),v(e)]},noteOn:function(t,n,e){return void 0===e&&(e=127),[144+g(t),b(n),v(e)]},aftertouch:function(t,n,e){return[160+g(t),b(n),v(e)]}},x={control:function(t,n,e){return[176+g(t),v(n),v(e)]},program:function(t,n){return[192+g(t),v(d.programValue(n),n)]},pressure:function(t,n){return[208+g(t),v(n)]},pitchBend:function(t,n,e){return void 0===e?[224+g(t),C(n),M(n)]:[224+g(t),v(e),v(n)]},pitchBendF:function(t,n){return x.pitchBend(t,d.to14b((n+1)/2))},bankMSB:function(t,n){return[176+g(t),0,v(n)]},bankLSB:function(t,n){return[176+g(t),32,v(n)]},modMSB:function(t,n){return[176+g(t),1,v(n)]},modLSB:function(t,n){return[176+g(t),33,v(n)]},breathMSB:function(t,n){return[176+g(t),2,v(n)]},breathLSB:function(t,n){return[176+g(t),34,v(n)]},footMSB:function(t,n){return[176+g(t),4,v(n)]},footLSB:function(t,n){return[176+g(t),36,v(n)]},portamentoMSB:function(t,n){return[176+g(t),5,v(n)]},portamentoLSB:function(t,n){return[176+g(t),37,v(n)]},dataMSB:function(t,n){return[176+g(t),6,v(n)]},dataLSB:function(t,n){return[176+g(t),38,v(n)]},volumeMSB:function(t,n){return[176+g(t),7,v(n)]},volumeLSB:function(t,n){return[176+g(t),39,v(n)]},balanceMSB:function(t,n){return[176+g(t),8,v(n)]},balanceLSB:function(t,n){return[176+g(t),40,v(n)]},panMSB:function(t,n){return[176+g(t),10,v(n)]},panLSB:function(t,n){return[176+g(t),42,v(n)]},expressionMSB:function(t,n){return[176+g(t),11,v(n)]},expressionLSB:function(t,n){return[176+g(t),43,v(n)]},damper:function(t,n){return void 0===n&&(n=!0),[176+g(t),64,n?127:0]},portamento:function(t,n){return void 0===n&&(n=!0),[176+g(t),65,n?127:0]},sostenuto:function(t,n){return void 0===n&&(n=!0),[176+g(t),66,n?127:0]},soft:function(t,n){return void 0===n&&(n=!0),[176+g(t),67,n?127:0]},legato:function(t,n){return void 0===n&&(n=!0),[176+g(t),68,n?127:0]},hold2:function(t,n){return void 0===n&&(n=!0),[176+g(t),69,n?127:0]},soundVariation:function(t,n){return[176+g(t),70,b(n)]},filterResonance:function(t,n){return[176+g(t),71,b(n)]},releaseTime:function(t,n){return[176+g(t),72,b(n)]},attackTime:function(t,n){return[176+g(t),73,b(n)]},brightness:function(t,n){return[176+g(t),74,b(n)]},decayTime:function(t,n){return[176+g(t),75,b(n)]},vibratoRate:function(t,n){return[176+g(t),76,b(n)]},vibratoDepth:function(t,n){return[176+g(t),77,b(n)]},vibratoDelay:function(t,n){return[176+g(t),78,b(n)]},ptc:function(t,n){return[176+g(t),84,b(n)]},dataIncr:function(t){return[176+g(t),96,0]},dataDecr:function(t){return[176+g(t),97,0]},nrpnLSB:function(t,n){return[176+g(t),98,v(n)]},nrpnMSB:function(t,n){return[176+g(t),99,v(n)]},rpnLSB:function(t,n){return[176+g(t),100,v(n)]},rpnMSB:function(t,n){return[176+g(t),101,v(n)]},allSoundOff:function(t){return[176+g(t),120,0]},resetAllControllers:function(t){return[176+g(t),121,0]},localControl:function(t,n){return void 0===n&&(n=!0),[176+g(t),122,n?127:0]},allNotesOff:function(t){return[176+g(t),123,0]},omni:function(t,n){return void 0===n&&(n=!0),[176+g(t),n?125:124,0]},mono:function(t,n){return void 0===n&&(n=1),[176+g(t),126,v(n)]},poly:function(t){return[176+g(t),127,0]}};function nn(t,n,e,r){return void 0!==n?[v(t),v(n),v(e),v(r)]:((t!=parseInt(t)||t<0||65535<t)&&Wt(t),[(t=parseInt(t))>>12&15,t>>8&15,t>>4&15,15&t])}function en(t){return jt(t),(t=Math.round(65536*t+16384))<0?0:65535<t?65535:t}var rn={mtc:function(t){return[241,function(t){var n;switch(!t.backwards&&4<=t.quarter?t.decrFrame():t.backwards&&t.quarter<4&&t.incrFrame(),t.quarter>>1){case 0:n=t.frame;break;case 1:n=t.second;break;case 2:n=t.minute;break;default:n=t.hour}return 1&t.quarter?n>>=4:n&=15,7==t.quarter&&(25==t.type?n|=2:29.97==t.type?n|=4:30==t.type&&(n|=6)),!t.backwards&&4<=t.quarter?t.incrFrame():t.backwards&&t.quarter<4&&t.decrFrame(),n|t.quarter<<4}(t)]},songPosition:function(t,n){return void 0===n?[242,C(t),M(t)]:[242,v(n),v(t)]},songSelect:function(t){return[243,v(t)]},tune:function(){return[246]},clock:function(){return[248]},start:function(){return[250]},continue:function(){return[251]},stop:function(){return[252]},active:function(){return[254]},reset:function(){return[255]}},S={sxIdRequest:function(){return[240,126,this._sxid,6,1,247]},sxTuningDumpRequest:function(t,n){return void 0===n?[240,126,this._sxid,8,0,v(t),247]:[240,126,this._sxid,8,3,v(t),v(n),247]},sxFullFrame:function(t){return[240,127,this._sxid,1,1,25==(n=t).type?32|n.hour:29.97==n.type?64|n.hour:30==n.type?96|n.hour:n.hour,t.getMinute(),t.getSecond(),t.getFrame(),247];var n},sxMasterVolume:function(t,n){return void 0===n?[240,127,this._sxid,4,1,C(t),M(t),247]:[240,127,this._sxid,4,1,v(n),v(t),247]},sxMasterVolumeF:function(t){return S.sxMasterVolume.call(this,d.to14b(Ht(t)))},sxMasterFineTuning:function(t,n){return void 0===n?[240,127,this._sxid,4,3,C(t),M(t),247]:[240,127,this._sxid,4,3,v(n),v(t),247]},sxMasterFineTuningF:function(t){return S.sxMasterFineTuning.call(this,d.to14b(Ht((t%1+1)/2,t)))},sxMasterCoarseTuning:function(t){return[240,127,this._sxid,4,4,0,v(t),247]},sxMasterCoarseTuningF:function(t){return S.sxMasterCoarseTuning.call(this,t-t%1+64)},sxNoteTuning:function(t,n,e,r){return n==parseInt(n)?[240,Qt(r),this._sxid,8,7,v(t),v(n)].concat(Kt(e),[247]):[240,127,this._sxid,8,2,v(t)].concat(Kt(n),[247])},sxNoteTuningF:function(t,n,e,r){return n==parseInt(n)?S.sxNoteTuning.call(this,t,n,Yt(e),r):S.sxNoteTuning.call(this,t,Yt(n))},sxNoteTuningHZ:function(t,n,e,r){return n==parseInt(n)?S.sxNoteTuning.call(this,t,n,$t(e),r):S.sxNoteTuning.call(this,t,$t(n))},sxScaleTuning1:function(t,n,e){return t==parseInt(t)?[240,Qt(e),this._sxid,8,8].concat(Xt(Jt(t)),function(t){var n=[];if(!(t instanceof Array)||12!=t.length)throw TypeError("Expected an array of size 12");for(var e=0;e<12;e++)n.push(v(t[e]));return n}(n),[247]):S.sxScaleTuning1.call(this,65535,t,n)},sxScaleTuning1F:function(t,n,e){if(t!=parseInt(t))return S.sxScaleTuning1F.call(this,65535,t,n);for(var r=[],i=0;i<n.length;i++){if(n[i]<-.64||.63<n[i])throw RangeError("Out of range: "+n[i]);r.push(Math.floor(100*n[i]+64))}return S.sxScaleTuning1.call(this,t,r,e)},sxScaleTuning2:function(t,n,e){return t==parseInt(t)?[240,Qt(e),this._sxid,8,9].concat(Xt(Jt(t)),function(t){var n=[];if(!(t instanceof Array)||12!=t.length)throw TypeError("Expected an array of size 12");for(var e=0;e<12;e++)n.push(M(t[e])),n.push(C(t[e]));return n}(n),[247]):S.sxScaleTuning2.call(this,65535,t,n)},sxScaleTuning2F:function(t,n,e){if(t!=parseInt(t))return S.sxScaleTuning2F.call(this,65535,t,n);for(var r=[],i=0;i<n.length;i++){var o=(n[i]+1)/2;if(o<-1||1<o)throw RangeError("Out of range: "+n[i]);r.push(d.to14b((n[i]+1)/2))}return S.sxScaleTuning2.call(this,t,r,e)},sxGM:function(t){return[240,126,this._sxid,9,(t=void 0===t?1:t)?2==t?3:1:2,247]},sxGS:function(t){for(var n=void 0===t?[64,0,127,0]:t instanceof Array?t:arguments,e=0,r=[240,65,this._sxid,66,18],i=0;i<n.length;i++){var o=v(n[i]);r.push(o),e+=o}return r.push((e%=128)?128-e:0),r.push(247),r},sxXG:function(t){for(var n=void 0===t?[0,0,126,0]:t instanceof Array?t:arguments,e=127==this._sxid?0:this._sxid,r=(15<e&&Ut("Bad Yamaha device number: "+e),[240,67,16+e,76]),i=0;i<n.length;i++)r.push(v(n[i]));return r.push(247),r},sxMidiSoft:function(t,n){var e=[240,0,32,36,0,v(t||0)];n=void 0===n?"":""+n;for(var r=0;r<n.length;r++)e.push(v(n.charCodeAt(r)));return e.push(247),e},gsMasterVolume:function(t){return S.sxGS.call(this,[64,0,4,v(t)])},gsMasterVolumeF:function(t){return S.gsMasterVolume.call(this,d.to7b(Ht(t)))},gsMasterFineTuning:function(t,n,e,r){return t=nn(t,n,e,r),S.sxGS.call(this,[64,0,0,t[0],t[1],t[2],t[3]])},gsMasterFineTuningF:function(t){return S.gsMasterFineTuning.call(this,en(t%1))},gsMasterCoarseTuning:function(t){return S.sxGS.call(this,[64,0,5,v(t)])},gsMasterCoarseTuningF:function(t){return S.gsMasterCoarseTuning.call(this,t-t%1+64)},gsOctaveTuning:function(t,n,e){return S.sxGS.call(this,[64,16+[1,2,3,4,5,6,7,8,9,0,11,12,13,14,15][g(t)],64+d.octaveValue(n),v(e)])},gsOctaveTuningF:function(t,n,e){if(e<-.64||.63<e)throw RangeError("Out of range: "+e);return S.gsOctaveTuning.call(this,t,n,Math.floor(100*e+64))},xgMasterVolume:function(t){return S.sxXG.call(this,[0,0,4,v(t)])},xgMasterVolumeF:function(t){return S.xgMasterVolume.call(this,d.to7b(Ht(t)))},xgMasterFineTuning:function(t,n,e,r){return t=nn(t,n,e,r),S.sxXG.call(this,[0,0,0,t[0],t[1],t[2],t[3]])},xgMasterFineTuningF:function(t){return S.xgMasterFineTuning.call(this,en(t%1))},xgMasterCoarseTuning:function(t){return S.sxXG.call(this,[0,0,6,v(t)])},xgMasterCoarseTuningF:function(t){return S.xgMasterCoarseTuning.call(this,t-t%1+64)},xgOctaveTuning:function(t,n,e){return S.sxXG.call(this,[8,g(t),65+d.octaveValue(n),v(e)])},xgOctaveTuningF:function(t,n,e){if(e<-.64||.63<e)throw RangeError("Out of range: "+e);return S.xgOctaveTuning.call(this,t,n,Math.floor(100*e+64))}},T=(S.sxScaleTuning=S.sxScaleTuning2,S.sxScaleTuningF=S.sxScaleTuning2F,S.sxMasterTranspose=S.sxMasterCoarseTuning,S.sxMasterTransposeF=S.sxMasterCoarseTuningF,S.gsMasterTranspose=S.gsMasterCoarseTuning,S.gsMasterTransposeF=S.gsMasterCoarseTuningF,S.xgMasterTranspose=S.xgMasterCoarseTuning,S.xgMasterTransposeF=S.xgMasterCoarseTuningF,{bank:function(t,n,e){return void 0===e?[x.bankMSB(t,M(n)),x.bankLSB(t,C(n))]:[x.bankMSB(t,n),x.bankLSB(t,e)]},modF:function(t,n){return T.mod(t,d.to14b(n))},mod:function(t,n,e){return void 0===e?[x.modMSB(t,M(n)),x.modLSB(t,C(n))]:[x.modMSB(t,n),x.modLSB(t,e)]},breathF:function(t,n){return T.breath(t,d.to14b(n))},breath:function(t,n,e){return void 0===e?[x.breathMSB(t,M(n)),x.breathLSB(t,C(n))]:[x.breathMSB(t,n),x.breathLSB(t,e)]},footF:function(t,n){return T.foot(t,d.to14b(n))},foot:function(t,n,e){return void 0===e?[x.footMSB(t,M(n)),x.footLSB(t,C(n))]:[x.footMSB(t,n),x.footLSB(t,e)]},portamentoTimeF:function(t,n){return T.portamentoTime(t,d.to14b(n))},portamentoTime:function(t,n,e){return void 0===e?[x.portamentoMSB(t,M(n)),x.portamentoLSB(t,C(n))]:[x.portamentoMSB(t,n),x.portamentoLSB(t,e)]},dataF:function(t,n){return T.data(t,d.to14b(n))},data:function(t,n,e){return void 0===e?[x.dataMSB(t,M(n)),x.dataLSB(t,C(n))]:[x.dataMSB(t,n),x.dataLSB(t,e)]},volumeF:function(t,n){return T.volume(t,d.to14b(n))},volume:function(t,n,e){return void 0===e?[x.volumeMSB(t,M(n)),x.volumeLSB(t,C(n))]:[x.volumeMSB(t,n),x.volumeLSB(t,e)]},balanceF:function(t,n){return T.balance(t,d.to14b((n+1)/2))},balance:function(t,n,e){return void 0===e?[x.balanceMSB(t,M(n)),x.balanceLSB(t,C(n))]:[x.balanceMSB(t,n),x.balanceLSB(t,e)]},panF:function(t,n){return T.pan(t,d.to14b((n+1)/2))},pan:function(t,n,e){return void 0===e?[x.panMSB(t,M(n)),x.panLSB(t,C(n))]:[x.panMSB(t,n),x.panLSB(t,e)]},expressionF:function(t,n){return T.expression(t,d.to14b(n))},expression:function(t,n,e){return void 0===e?[x.expressionMSB(t,M(n)),x.expressionLSB(t,C(n))]:[x.expressionMSB(t,n),x.expressionLSB(t,e)]},nrpn:function(t,n,e){return void 0===e?[x.nrpnMSB(t,M(n)),x.nrpnLSB(t,C(n))]:[x.nrpnMSB(t,n),x.nrpnLSB(t,e)]},rpn:function(t,n,e){return void 0===e?[x.rpnMSB(t,M(n)),x.rpnLSB(t,C(n))]:[x.rpnMSB(t,n),x.rpnLSB(t,e)]},rpnPitchBendRange:function(t,n,e){return T.rpn(t,0,0).concat(T.data(t,n,e))},rpnPitchBendRangeF:function(t,n){return T.rpnPitchBendRange(t,v(n-n%1),Math.floor(n%1*100))},rpnFineTuning:function(t,n,e){return T.rpn(t,0,1).concat(T.data(t,n,e))},rpnFineTuningF:function(t,n){return T.rpn(t,0,1).concat(T.dataF(t,(n%1+1)/2))},rpnCoarseTuning:function(t,n){return T.rpn(t,0,2).concat([x.dataMSB(t,n)])},rpnCoarseTuningF:function(t,n){return T.rpn(t,0,2).concat([x.dataMSB(t,n-n%1+64)])},rpnTuning:function(t,n,e,r){return T.rpnCoarseTuning(t,n).concat(T.rpnFineTuning(t,e,r))},rpnTuningF:function(t,n){return T.rpnCoarseTuningF(t,n).concat(T.rpnFineTuningF(t,n))},rpnTuningA:function(t,n){return T.rpnTuningF(t,d.shift(n))},rpnSelectTuningProgram:function(t,n){return T.rpn(t,0,3).concat([x.dataMSB(t,n)])},rpnSelectTuningBank:function(t,n){return T.rpn(t,0,4).concat([x.dataMSB(t,n)])},rpnSelectTuning:function(t,n,e){return void 0===e?T.rpnSelectTuningProgram(t,n):T.rpnSelectTuningBank(t,n).concat(T.rpnSelectTuningProgram(t,e))},rpnModulationDepthRange:function(t,n,e){return T.rpn(t,0,5).concat(T.data(t,n,e))},rpnModulationDepthRangeF:function(t,n){return T.rpnModulationDepthRange(t,v(n-n%1),Math.floor(n%1*128))},rpnNull:function(t){return T.rpn(t,127,127)},mode1:function(t){return[x.omni(t,!0),x.poly(t)]},mode2:function(t){return[x.omni(t,!0),x.mono(t)]},mode3:function(t){return[x.omni(t,!1),x.poly(t)]},mode4:function(t){return[x.omni(t,!1),x.mono(t)]}}),on=(T.rpnTranspose=T.rpnCoarseTuningF,{sxMasterTuning:function(t,n,e){return[S.sxMasterCoarseTuning.call(this,t),S.sxMasterFineTuning.call(this,n,e)]},sxMasterTuningF:function(t){return[S.sxMasterCoarseTuningF.call(this,t),S.sxMasterFineTuningF.call(this,t)]},gsMasterTuningF:function(t){return[S.gsMasterCoarseTuningF.call(this,t),S.gsMasterFineTuningF.call(this,t)]},xgMasterTuningF:function(t){return[S.xgMasterCoarseTuningF.call(this,t),S.xgMasterFineTuningF.call(this,t)]},sxMasterTuningA:function(t){return on.sxMasterTuningF.call(this,d.shift(t))},gsMasterTuningA:function(t){return on.gsMasterTuningF.call(this,d.shift(t))},xgMasterTuningA:function(t){return on.xgMasterTuningF.call(this,d.shift(t))},gsScaleTuning:function(t,n){var e=[];if(12!=n.length)throw RangeError("Wrong input size: "+n.length);for(var r=0;r<12;r++)e.push(S.gsOctaveTuning.call(this,t,r,n[r]));return e},gsScaleTuningF:function(t,n){var e=[];if(12!=n.length)throw RangeError("Wrong input size: "+n.length);for(var r=0;r<12;r++)e.push(S.gsOctaveTuningF.call(this,t,r,n[r]));return e},xgScaleTuning:function(t,n){var e=[];if(12!=n.length)throw RangeError("Wrong input size: "+n.length);for(var r=0;r<12;r++)e.push(S.xgOctaveTuning.call(this,t,r,n[r]));return e},xgScaleTuningF:function(t,n){var e=[];if(12!=n.length)throw RangeError("Wrong input size: "+n.length);for(var r=0;r<12;r++)e.push(S.xgOctaveTuningF.call(this,t,r,n[r]));return e}});function w(t,n){var e=new d;return e.ff=y(t),e.dd=void 0===n?"":function(t){t=""+t;for(var n=0;n<t.length;n++)255<t.charCodeAt(n)&&Ut(t[n]);return t}(n),e}var sn={smf:function(t){if(t instanceof d)return new d(t);var n=t instanceof Array?t:arguments,e=y(n[0]),r="";return 2==n.length?r=ln(n[1]):2<n.length&&(r=ln(Array.prototype.slice.call(n,1))),w(e,r)},smfSeqNumber:function(t){if(t==parseInt(t)){if(t<0||65535<t)throw RangeError("Sequence number out of range: "+t);t=String.fromCharCode(t>>8)+String.fromCharCode(255&t)}else if(0==(t=""+t).length)t="\0\0";else if(1==t.length)t="\0"+t;else if(2<t.length)throw RangeError("Sequence number out of range"+vn(t));return w(0,t)},smfText:function(t){return w(1,p.lib.toUTF8(t))},smfCopyright:function(t){return w(2,p.lib.toUTF8(t))},smfSeqName:function(t){return w(3,p.lib.toUTF8(t))},smfInstrName:function(t){return w(4,p.lib.toUTF8(t))},smfLyric:function(t){return w(5,p.lib.toUTF8(t))},smfMarker:function(t){return w(6,p.lib.toUTF8(t))},smfCuePoint:function(t){return w(7,p.lib.toUTF8(t))},smfProgName:function(t){return w(8,p.lib.toUTF8(t))},smfDevName:function(t){return w(9,p.lib.toUTF8(t))},smfChannelPrefix:function(t){if(t==parseInt(t))bt(t),t=String.fromCharCode(t);else if(0==(t=""+t).length)t="\0";else if(1<t.length||15<t.charCodeAt(0))throw RangeError("Channel number out of range"+vn(t));return w(32,t)},smfMidiPort:function(t){if(t==parseInt(t)){if(t<0||127<t)throw RangeError("Port number out of range: "+t);t=String.fromCharCode(t)}else if(0==(t=""+t).length)t="\0";else if(1<t.length||127<t.charCodeAt(0))throw RangeError("Port number out of range"+vn(t));return w(33,t)},smfEndOfTrack:function(t){if(""!=ln(t))throw RangeError("Unexpected data"+vn(ln(t)));return w(47)},smfTempo:function(t){if(3==(""+t).length)return w(81,t);if(t==parseInt(t)&&0<t&&t<=16777215)return w(81,String.fromCharCode(t>>16)+String.fromCharCode(t>>8&255)+String.fromCharCode(255&t));throw RangeError("Out of range"+vn(ln(t)))},smfBPM:function(t){return sn.smfTempo(Math.round(6e7/t))},smfSMPTE:function(t){if(t instanceof l)return w(84,String.fromCharCode(t.hour)+String.fromCharCode(t.minute)+String.fromCharCode(t.second)+String.fromCharCode(t.frame)+String.fromCharCode(t.quarter%4*25));if(5==(""+t).length)return w(84,t);var n=t instanceof Array?t:Array.prototype.slice.call(arguments);return n.splice(0,0,30),sn.smfSMPTE(new l(n))},smfTimeSignature:function(t,n,e,r){var i,o,s,u,a=(""+t).match(/^\s*(\d+)\s*\/\s*(\d+)\s*$/);if(a){if(i=parseInt(a[1]),o=parseInt(a[2]),0<i&&i<256&&0<o&&!(o&o-1)){for(s=o,o=0,s>>=1;s;s>>=1)o++;return s=n==parseInt(n)?n:24,u=e==parseInt(e)?e:8,w(88,String.fromCharCode(i)+String.fromCharCode(o)+String.fromCharCode(s)+String.fromCharCode(u))}if(4==(""+t).length)return w(88,t)}else if(t==parseInt(t)&&n==parseInt(n)){if(0<t&&t<256&&0<n&&!(n&n-1)){for(i=t,o=0,s=n,s>>=1;s;s>>=1)o++;return s=e==parseInt(e)?e:24,u=r==parseInt(r)?r:8,w(88,String.fromCharCode(i)+String.fromCharCode(o)+String.fromCharCode(s)+String.fromCharCode(u))}if(4==(""+t).length)return w(88,t);t=t+"/"+n}else if(4==(""+t).length)return w(88,t);throw RangeError("Wrong time signature"+vn(ln(""+t)))},smfKeySignature:function(t){var n,e=(t=""+t).match(/^\s*([A-H][b#]?)\s*(|maj|major|dur|m|min|minor|moll)\s*$/i);if(e&&(n={CB:0,GB:1,DB:2,AB:3,EB:4,BB:5,F:6,C:7,G:8,D:9,A:10,E:11,B:12,H:12,"F#":13,"C#":14,"G#":15,"D#":16,"A#":17}[e[1].toUpperCase()],e={"":0,MAJ:0,MAJOR:0,DUR:0,M:1,MIN:1,MINOR:1,MOLL:1}[e[2].toUpperCase()],void 0!==n&&void 0!==e&&(e&&(n-=3),-7<=(n-=7)&&n<0?t=String.fromCharCode(256+n)+String.fromCharCode(e):0<=n&&n<=7&&(t=String.fromCharCode(n)+String.fromCharCode(e)))),2==t.length&&t.charCodeAt(1)<=1&&(t.charCodeAt(0)<=7||t.charCodeAt(0)<=255&&249<=t.charCodeAt(0)))return w(89,t);throw RangeError("Incorrect key signature"+vn(t))},smfSequencer:function(t){return w(127,ln(t))}},un={};function an(t,n){d[t]=function(){return new d(n.apply(this,arguments))},un[t]=function(){return this.send(n.apply(this,arguments))}}function cn(n){s(un,function(t){n.prototype[t]=un[t]})}s(rn,function(t){an(t,rn[t])}),s(S,function(t){an(t,S[t])}),s(sn,function(t){var n;n=sn[t=t],d[t]=function(){return n.apply(this,arguments)},un[t]=function(){return this.send(n.apply(this,arguments))}}),s(on,function(t){var r;r=on[t=t],d[t]=function(){for(var t=[],n=r.apply(this,arguments),e=0;e<n.length;e++)t.push(new d(n[e]));return t},un[t]=function(){for(var t=r.apply(this,arguments),n=this,e=0;e<t.length;e++)n=n.send(t[e]);return n}}),s(tn,function(t){var n;n=tn[t=t],d[t]=function(){return new d(n.apply(this,void 0===this._ch?arguments:[this._ch].concat(Array.prototype.slice.call(arguments))))},un[t]=function(){var t;return void 0!==this._master?((t=new d(n.apply(this,[this._master].concat(Array.prototype.slice.call(arguments)))))._mpe=t[1],this.send(t)):this.send(n.apply(this,void 0===this._ch?arguments:[this._ch].concat(Array.prototype.slice.call(arguments))))}}),s(x,function(t){var e;e=x[t=t],d[t]=function(){return new d(e.apply(this,void 0===this._ch?arguments:[this._ch].concat(Array.prototype.slice.call(arguments))))},un[t]=function(){var t,n;return void 0!==this._master?((n=Array.prototype.slice.call(arguments)).length<e.length?n=[this._master].concat(n):(t=b(n[0]),n[0]=this._master),(n=new d(e.apply(this,n)))._mpe=t,this.send(n)):this.send(e.apply(this,void 0===this._ch?arguments:[this._ch].concat(Array.prototype.slice.call(arguments))))}}),s(T,function(t){var s;s=T[t=t],d[t]=function(){for(var t=[],n=s.apply(this,void 0===this._ch?arguments:[this._ch].concat(Array.prototype.slice.call(arguments))),e=0;e<n.length;e++)t.push(new d(n[e]));return t},un[t]=function(){var t,n,e;if(void 0!==this._master){var r,i=Array.prototype.slice.call(arguments);for(i.length<s.length?i=[this._master].concat(i):(r=b(i[0]),i[0]=this._master),n=s.apply(this,i),e=this,t=0;t<n.length;t++){var o=d(n[t]);o._mpe=r,e=e.send(o)}return e}for(n=s.apply(this,void 0===this._ch?arguments:[this._ch].concat(Array.prototype.slice.call(arguments))),e=this,t=0;t<n.length;t++)e=e.send(n[t]);return e}}),cn(c);for(var hn={a:10,b:11,c:12,d:13,e:14,f:15,A:10,B:11,C:12,D:13,E:14,F:15},fn=0;fn<16;fn++)hn[fn]=fn;function pn(t){for(var n=[],e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n}function ln(t){if(t instanceof Array){for(var n=t,e="",r=0;r<n.length;r++)e+=String.fromCharCode(n[r]);return e}return void 0===t?"":""+t}function I(t){return(t<16?"0":"")+t.toString(16)}function dn(t){for(var n=[],e=0;e<t.length;e++)n.push(I(t[e]));return n.join(" ")}function mn(t){for(var n=[],e=0;e<t.length;e++)e&&e%4==0&&n.push(" "),n.push(I(t[e]));return n.join("")}function gn(t){for(var n="",e=0;e<t.length;e++)"\n"==t[e]?n+="\\n":"\r"==t[e]?n+="\\r":"\t"==t[e]?n+="\\t":t.charCodeAt(e)<32?n+="\\x"+I(t.charCodeAt(e)):n+=t[e];return n}function _n(t){return t.length?": "+dn(pn(t)):""}function vn(t){return t.length?": "+gn(p.lib.fromUTF8(t)):""}function yn(){var t;for(this._cc=[],t=0;t<16;t++)this._cc[t]={}}function bn(t){if(!t.length||t[0]<128)return t;if(255==t[0])return this._clear(),t;var n,e,r,i=15&t[0],o=t[0]>>4;if(12==o)t._bm=this._cc[i].bm,t._bl=this._cc[i].bl,p.MIDI.programName&&t.label(p.MIDI.programName(t[1],t._bm,t._bl));else if(11==o)switch(t[1]){case 0:this._cc[i].bm=t[2];break;case 32:this._cc[i].bl=t[2];break;case 98:this._cc[i].nl=t[2],this._cc[i].rn="n";break;case 99:this._cc[i].nm=t[2],this._cc[i].rn="n";break;case 100:this._cc[i].rl=t[2],this._cc[i].rn="r";break;case 101:this._cc[i].rm=t[2],this._cc[i].rn="r";break;case 6:case 38:case 96:case 97:"r"==this._cc[i].rn&&(t._rm=this._cc[i].rm,t._rl=this._cc[i].rl,t.label((r=this._cc[i].rm,e=this._cc[i].rl,r=void 0===r?"??":I(r),e=void 0===e?"??":I(e),"RPN "+r+" "+e+((r={"0000":"Pitch Bend Sensitivity","0001":"Channel Fine Tuning","0002":"Channel Coarse Tuning","0003":"Select Tuning Program","0004":"Select Tuning Bank","0005":"Vibrato Depth Range","7f7f":"NONE"}[r+""+e])?": "+r:"")))),"n"==this._cc[i].rn&&(t._nm=this._cc[i].rm,t._nl=this._cc[i].nl,t.label((e=this._cc[i].nm,r=this._cc[i].nl,"NRPN "+(void 0===e?"??":I(e))+" "+(void 0===r?"??":I(r)))))}else t.isFullSysEx()&&(127==t[1]?4==t[3]?(n={1:"Master Volume",2:"Master Balance",3:"Master Fine Tuning",4:"Master Coarse Tuning"}[t[4]])&&t.label(n):8==t[3]&&(n={2:"Note Tuning",7:"Note Tuning, Bank",8:"Scale Tuning, 1 byte format",9:"Scale Tuning, 2 byte format"}[t[4]])&&t.label(n):126==t[1]?6==t[3]?1==t[4]?t.label("Device ID Request"):2==t[4]&&t.label("Device ID Response"):8==t[3]?(n={0:"Bulk Tuning Dump Request",1:"Bulk Tuning Dump",3:"Bulk Tuning Dump Request, Bank",4:"Bulk Tuning Dump, Bank",5:"Scale Tuning Dump, 1 byte format",6:"Scale Tuning Dump, 2 byte format",7:"Note Tuning, Bank",8:"Scale Tuning, 1 byte format",9:"Scale Tuning, 2 byte format"}[t[4]])&&t.label(n):9==t[3]&&(1==t[4]?(t.label("GM1 System On"),this._clear(),this._gm="1"):2==t[4]?(t.label("GM System Off"),this._clear(),this._gm="0"):3==t[4]&&(t.label("GM2 System On"),this._clear(),this._gm="2")):67==t[1]?16==(240&t[2])&&76==t[3]&&(0==t[4]&&0==t[5]&&126==t[6]&&0==t[7]?(t.label("XG System On"),this._clear(),this._gm="Y"):0==t[4]&&0==t[5]&&0==t[6]?t.label("XG Master Tuning"):0==t[4]&&0==t[5]&&4==t[6]?t.label("XG Master Volume"):0==t[4]&&0==t[5]&&6==t[6]?t.label("XG Master Transpose"):8==t[4]&&t[5]<16&&65<=t[6]&&t[6]<=76?t.label("XG Scale Tuning"):t.label("XG Parameter")):65==t[1]&&66==t[3]&&18==t[4]&&(64==t[5]&&(0==t[6]?127==t[7]&&0==t[8]&&65==t[9]?(t.label("GS Reset"),this._clear(),this._gm="R"):0==t[7]?t.label("GS Master Tuning"):4==t[7]?t.label("GS Master Volume"):5==t[7]?t.label("GS Master Transpose"):t.label("GS Parameter"):16==(240&t[6])&&21==t[7]?t.label("GS Drum Part Change"):16==(240&t[6])&&64<=t[7]&&t[7]<=75?t.label("GS Scale Tuning"):t.label("GS Parameter")),65==t[5]&&t.label("GS Parameter")));return t}function Cn(){var t=new c;return t._clear=yn,t._read=bn,t._receive=function(t){this._emit(this._read(t))},t._clear(),t._resume(),t}function Mn(){var t=this instanceof Mn?this:new Mn;return t.reset(),arguments.length&&Mn.prototype.setup.apply(t,arguments),t}function A(n){var e=this instanceof A?this:new A;if(n instanceof A)return e._from=n._from.slice(),s(n,function(t){"_from"!=t&&(e[t]=n[t])}),e;e._from=[];for(var t=(n=void 0===n?[0,0,0,0]:n)instanceof Array?n:arguments,r=e.length=0;r<t.length;r++)((i=t[r])!=parseInt(i)||i<0||255<i)&&Ut(t[r]),e.push(i);if(e.length!=[4,4,4,8,8,16,4,4,8,8,8,12,12,16,16,16][e[0]>>4])throw RangeError("Wrong UMP size");return e}function xn(){}d.prototype.getChannel=function(){if(32==this.ff&&1==this.dd.length&&this.dd.charCodeAt(0)<16)return this.dd.charCodeAt(0);var t=this[0];return void 0===t||t<128||239<t?void 0:15&t},d.prototype.setChannel=function(t){return void 0===(t=hn[t])||(32==this.ff?this.dd=String.fromCharCode(t):void 0!==(n=this[0])&&128<=n&&n<=239&&(this[0]=240&n|t)),this;var n},d.prototype.getNote=function(){var t=this[0];if(!(void 0===t||t<128||175<t))return this[1]},d.prototype.setNote=function(t){var n=this[0];return void 0===n||n<128||175<n||void 0!==(t=d.noteValue(t))&&(this[1]=t),this},d.prototype.getVelocity=function(){var t=this[0];if(!(void 0===t||t<128||159<t))return this[2]},d.prototype.setVelocity=function(t){var n=this[0];return void 0===n||n<128||159<n||0<=(t=parseInt(t))&&t<128&&(this[2]=t),this},d.prototype.getSysExId=function(){if(240==this[0])return this[2]},d.prototype.setSysExId=function(t){return 240==this[0]&&2<this.length&&0<=(t=parseInt(t))&&t<128&&(this[2]=t),this},d.prototype.getData=function(){if(void 0!==this.dd)return this.dd.toString()},d.prototype.setData=function(t){return this.dd=ln(t),this},d.prototype.getText=function(){if(void 0!==this.dd)return t=this.ff,n=this.dd,e=n,127==t&&void 0!==e&&67==e.charCodeAt(0)&&123==e.charCodeAt(1)&&1==n.charCodeAt(2)?(t=this.dd.charCodeAt(3),e=this.dd.charCodeAt(4),0<=t&&t<=127&&0<=e&&e<=127?(n=t>>4,0<(t=15&t)&&t<8&&n<7?(t=["C","D","E","F","G","A","B"][t-1]+["bbb","bb","b","","#","##","###"][n],34<e?t+"?":t+["","6","Maj7","Maj7(#11)","(9)","Maj7(9)","6(9)","aug","m","m6","m7","m7b5","m(9)","m7(9)","m7(11)","m+7","m+7(9)","dim","dim7","7","7sus4","7b5","7(9)","7(#11)","7(13)","7(b9)","7(b13)","7(#9)","Maj7aug","7aug","1+8","1+5","sus4","1+2+5","cc"][e]):"-"):"-"):p.lib.fromUTF8(this.dd);var t,n,e;if(this.isMidiSoft()){for(var r=[],i=6;i<this.length-1;i++)r.push(String.fromCharCode(this[i]));return r.join("")}},d.prototype.setText=function(t){return this.dd=p.lib.toUTF8(t),this},d.prototype.getTempo=function(){if(81==this.ff&&void 0!==this.dd)return 65536*this.dd.charCodeAt(0)+256*this.dd.charCodeAt(1)+this.dd.charCodeAt(2)},d.prototype.getBPM=function(){var t=this.getTempo();if(t)return 6e7/t},d.prototype.getTimeSignature=function(){if(88==this.ff&&void 0!==this.dd)return[this.dd.charCodeAt(0),1<<this.dd.charCodeAt(1)]},d.prototype.getTimeSignature4=function(){var t;if(88==this.ff&&void 0!==this.dd)return t=[this.dd.charCodeAt(0),1<<this.dd.charCodeAt(1)],4==this.dd.length&&t.push(this.dd.charCodeAt(2),this.dd.charCodeAt(3)),t},d.prototype.getKeySignature=function(){if(89==this.ff&&void 0!==this.dd){var t=this.dd.charCodeAt(0),n=this.dd.charCodeAt(1);if(128&t&&(t-=256),-7<=t&&t<=7&&0<=n&&n<=1)return[t,["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#","G#","D#","A#"][n?t+10:t+7],!!n]}},d.prototype.isNoteOn=function(){var t=this[0];return!(void 0===t||t<144||159<t)&&0<this[2]},d.prototype.isNoteOff=function(){var t=this[0];return!(void 0===t||t<128||159<t)&&(t<144||0==this[2])},d.prototype.isSysEx=function(){return 240==this[0]},d.prototype.isFullSysEx=function(){return 240==this[0]&&247==this[this.length-1]},d.prototype.isMidiSoft=function(){return this.isFullSysEx()&&0==this[1]&&32==this[2]&&36==this[3]&&0==this[4]},d.prototype.isSMF=function(){return 0<=this.ff&&this.ff<=127},d.prototype.isEOT=function(){return 47==this.ff},d.prototype.isText=function(){return 1==this.ff},d.prototype.isCopyright=function(){return 2==this.ff},d.prototype.isSeqName=function(){return 3==this.ff},d.prototype.isInstrName=function(){return 4==this.ff},d.prototype.isLyric=function(){return 5==this.ff},d.prototype.isMarker=function(){return 6==this.ff},d.prototype.isCuePoint=function(){return 7==this.ff},d.prototype.isProgName=function(){return 8==this.ff},d.prototype.isDevName=function(){return 9==this.ff},d.prototype.isTempo=function(){return 81==this.ff},d.prototype.isTimeSignature=function(){return 88==this.ff},d.prototype.isKeySignature=function(){return 89==this.ff},d.prototype.isGmReset=function(){return this.match([240,126,[0,0],9,[0,0],247])},d.prototype.isGsReset=function(){return this.match([240,65,[0,0],66,18,64,0,127,0,65,247])},d.prototype.isXgReset=function(){return this.match([240,67,[16,240],76,0,0,126,0,247])},d.prototype.match=function(t){for(var n,e=0;e<t.length;e++)if(void 0===(n=t[e][1])){if(this[e]!=t[e])return!1}else if((this[e]&n)!=(t[e][0]&n))return!1;return!0},d.prototype.label=function(t){return this.lbl=this.lbl?this.lbl+", "+t:t,this},d.prototype.toString=function(){return this.lbl?this._str()+" ("+this.lbl+")":this._str()},d.prototype._str=function(){var t,n;if(this.length)t=dn(this);else{if(void 0===this.ff)return"empty";t="ff"+I(this.ff)}return(n=this._string())?t+" -- "+n:t},d.prototype._string=function(){var t="";if(!this.length){if(0==this.ff)t+="Sequence Number: "+function(t){for(var n=0,e=0;e<t.length;e++)n=(n<<8)+t.charCodeAt(e);return n}(this.dd);else if(0<this.ff&&this.ff<10)t+=["","Text","Copyright","Sequence Name","Instrument Name","Lyric","Marker","Cue Point","Program Name","Device Name"][this.ff]+vn(this.dd);else if(32==this.ff)t+="Channel Prefix"+_n(this.dd);else if(33==this.ff)t+="MIDI Port"+_n(this.dd);else if(47==this.ff)t+="End of Track"+_n(this.dd);else if(81==this.ff)t+="Tempo: "+Math.round(100*this.getBPM())/100+" bpm";else if(84==this.ff)t+="SMPTE Offset: "+Gt(pn(this.dd));else if(88==this.ff)var n=1<<this.dd.charCodeAt(1),t=(t+="Time Signature: "+this.dd.charCodeAt(0)+"/"+n)+(" "+this.dd.charCodeAt(2)+" "+this.dd.charCodeAt(3));else if(89==this.ff){t+="Key Signature: ";n=this.getKeySignature();n?(t+=n[1],n[2]&&(t+=" min")):t+="invalid"}else if(127==this.ff){if(67==this.dd.charCodeAt(0)&&123==this.dd.charCodeAt(1))return t=(t+="[XF:"+I(this.dd.charCodeAt(2))+"]")+((e={0:"Version",1:"Chord",2:"Rehearsal Mark",3:"Phrase Mark",4:"Max Phrase Mark",5:"Fingering Number",12:"Guide Track Flag",16:"Guitar Info",18:"Chord Voicing",127:"XG Song Data Number"}[this.dd.charCodeAt(2)])?" "+e:"")+": ",0==this.dd.charCodeAt(2)?t+this.dd.substr(3,4)+" "+dn(pn(this.dd.substr(7))):1==this.dd.charCodeAt(2)?t+this.getText():t+dn(pn(this.dd.substr(3)));t+="Sequencer Specific"+_n(this.dd)}else t+="SMF"+_n(this.dd);return t}if(e={241:"MIDI Time Code",242:"Song Position",243:"Song Select",244:"Undefined",245:"Undefined",246:"Tune request",248:"Timing clock",249:"Undefined",250:"Start",251:"Continue",252:"Stop",253:"Undefined",254:"Active Sensing",255:"Reset"}[this[0]])return e;if(this.isMidiSoft())return e=(e=gn(this.getText()))&&" "+e,"[K:"+I(this[5])+"]"+e;var e,n=this[0]>>4;return(e={8:"Note Off",10:"Aftertouch",12:"Program Change",13:"Channel Aftertouch",14:"Pitch Wheel"}[n])?e:9==n?this[2]?"Note On":"Note Off":11!=n?t:(e={0:"Bank Select MSB",1:"Modulation Wheel MSB",2:"Breath Controller MSB",4:"Foot Controller MSB",5:"Portamento Time MSB",6:"Data Entry MSB",7:"Channel Volume MSB",8:"Balance MSB",10:"Pan MSB",11:"Expression Controller MSB",12:"Effect Control 1 MSB",13:"Effect Control 2 MSB",16:"General Purpose Controller 1 MSB",17:"General Purpose Controller 2 MSB",18:"General Purpose Controller 3 MSB",19:"General Purpose Controller 4 MSB",31:"Karaoke",32:"Bank Select LSB",33:"Modulation Wheel LSB",34:"Breath Controller LSB",36:"Foot Controller LSB",37:"Portamento Time LSB",38:"Data Entry LSB",39:"Channel Volume LSB",40:"Balance LSB",42:"Pan LSB",43:"Expression Controller LSB",44:"Effect control 1 LSB",45:"Effect control 2 LSB",48:"General Purpose Controller 1 LSB",49:"General Purpose Controller 2 LSB",50:"General Purpose Controller 3 LSB",51:"General Purpose Controller 4 LSB",64:"Damper Pedal",65:"Portamento",66:"Sostenuto",67:"Soft Pedal",68:"Legato",69:"Hold 2",70:"Sound Variation",71:"Filter Resonance",72:"Release Time",73:"Attack Time",74:"Brightness",75:"Decay Time",76:"Vibrato Rate",77:"Vibrato Depth",78:"Vibrato Delay",79:"Sound Controller 10",80:"General Purpose Controller 5",81:"General Purpose Controller 6",82:"General Purpose Controller 7",83:"General Purpose Controller 8",84:"Portamento Control",88:"High Resolution Velocity Prefix",91:"Effects 1 Depth",92:"Effects 2 Depth",93:"Effects 3 Depth",94:"Effects 4 Depth",95:"Effects 5 Depth",96:"Data Increment",97:"Data Decrement",98:"Non-Registered Parameter Number LSB",99:"Non-Registered Parameter Number MSB",100:"Registered Parameter Number LSB",101:"Registered Parameter Number MSB",120:"All Sound Off",121:"Reset All Controllers",122:"Local Control On/Off",123:"All Notes Off",124:"Omni Mode Off",125:"Omni Mode On",126:"Mono Mode On",127:"Poly Mode On"}[this[1]],64<=this[1]&&this[1]<=69&&(e+=this[2]<64?" Off":" On"),e||"Undefined")},d.prototype._stamp=function(t){return this._from.push(t._orig||t),this},d.prototype._unstamp=function(t){return void 0===t?this._from=[]:(t._orig&&(t=t._orig),-1<(t=this._from.indexOf(t))&&this._from.splice(t,1)),this},d.prototype._stamped=function(t){t._orig&&(t=t._orig);for(var n=0;n<this._from.length;n++)if(this._from[n]==t)return!0;return!1},p.MIDI=d,r.prototype.MIDI=d,p.Context=Cn,r.prototype.Context=Cn,Mn.validate=function(t){var n=t instanceof Array?t:arguments;if(n[0]!=parseInt(n[0])||n[0]<0||14<n[0])throw RangeError("Bad master channel value: "+n[0]);if(n[1]!=parseInt(n[1])||n[1]<0||15<n[0]+n[1])throw RangeError("Bad zone size value: "+n[1])},Mn.prototype.reset=function(){for(var t=0;t<16;t++)this[t]={band:0,master:t}},Mn.prototype.setup=function(t,n){Mn.validate(t,n);var e,r=t+n;if((this[t].master!=t||this[t].band!=n)&&(n||this[t].band)){for(this[t].band?r<(e=t+this[t].band)&&(r=e):this[t].master==t-1?(e=t-1,r<(e+=this[e].band)&&(r=e),this[t-1]={band:0,master:t-1}):this[t].master!=t&&(e=this[t].master,r<(e+=this[e].band)&&(r=e),this[this[t].master].band=t-this[t].master-1),this[t].master=t,this[t].band=n,e=t+1;e<=t+n;e++)this[e].band&&r<e+this[e].band&&(r=e+this[e].band),this[e]={band:0,master:t};for(;e<=r;e++)this[e]={band:0,master:e}}},Mn.prototype.filter=function(t){var n=t.getChannel();if(!this[n]||!this[this[n].master].band)return t;var e,r,i,o=this[n].master,s=this[o].band;if(void 0!==t._mpe){for(i=256,e=o+1;e<=o+s;e++)if(this[e].notes){for(i>this[e].notes.length&&(i=this[n=e].notes.length),r=0;r<this[e].notes.length;r++)if(this[e].notes[r]==t._mpe){n=e,i=-1;break}}else 0<i&&(n=e,i=0);t.setChannel(n),t._mpe=void 0}return n==o||(t.isNoteOn()?(this[n].notes||(this[n].notes=[]),Y(this[n].notes,t.getNote())):t.isNoteOff()&&this[n].notes&&$(this[n].notes,t.getNote())),t},p.MPE=Mn,((A.prototype=[]).constructor=A).prototype.isMidi=function(){return 2},A.prototype.isMidi2=!0,A.prototype.dump=function(){for(var t="",n=0;n<this.length;n++)t+=String.fromCharCode(this[n]);return t},(xn.prototype=A)._sxid=127,A.sxId=function(t){if((t=void 0===t?A._sxid:t)==this._sxid)return this;t=v(t);var n=new xn;return n._ch=this._ch,n._gr=this._gr,n._sxid=t,n},A.ch=function(t){if(t==this._ch||void 0===t&&void 0===this._ch)return this;var n=new xn;return void 0!==t&&(t=g(t)),n._ch=t,n._gr=this._gr,n._sxid=this._sxid,n},A.gr=function(t){if(t==this._gr||void 0===t&&void 0===this._gr)return this;var n=new xn;return void 0!==t&&(t=_(t)),n._ch=this._ch,n._gr=t,n._sxid=this._sxid,n},A.prototype.getGroup=function(){var t;if(this[0])return t=this[0]>>4,1==t||2==t||3==t||4==t||5==t||13==t?15&this[0]:void 0};var Sn=[0,0,0,0,0,0,0,0,0,0,0,0,0];function Tn(t,n,e,r){return void 0!==n?[y(t),y(n),y(e),y(r)]:(((n=t)!=parseInt(n)||n<0||4294967295<n)&&Ut(n),[(t=parseInt(n))>>24&255,t>>16&255,t>>8&255,255&t])}function wn(t){return 4294967295<(t=Math.floor(4294967296*t))?4294967295:t<0?0:t}var In={noop:function(){return[0,0,0,0]},umpClock:function(t){return[0,16,(t=Jt(t))>>8,255&t]},umpTimestamp:function(t){return[0,32,(t=Jt(t))>>8,255&t]},umpTicksPQN:function(t){return[0,48,(t=Jt(t))>>8,255&t]},umpDelta:function(t){return[0,64+((t=function(t){if(t!=parseInt(t)||t<0||1048575<t)throw RangeError("Expected a 20-bit value: "+t);return parseInt(t)}(t=t||0))>>16),t>>8&255,255&t]},umpStartClip:function(){return[240,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},umpEndClip:function(){return[240,33,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},An={umpTempo:function(t,n){return[208+_(t),16,0,0].concat(Tn(n),[0,0,0,0,0,0,0,0])},umpBPM:function(t,n){return An.umpTempo(t,Math.round(6e9/n))},umpTimeSignature:function(t,n,e){var r,i,o,s=(""+n).match(/^\s*(\d+)\s*\/\s*(\d+)\s*$/);if(s?(r=parseInt(s[1]),i=parseInt(s[2])):n==parseInt(n)&&e==parseInt(e)&&(r=parseInt(n),i=parseInt(e)),0<r&&r<256&&0<i&&!(i&i-1)){for(o=0,i>>=1;i;i>>=1)o++;if((i=Math.round(32*r/(1<<o)))<256)return[208+_(t),16,0,1,r,o,i,0,0,0,0,0,0,0,0,0]}throw RangeError("Wrong time signature "+n+(void 0===e?"":"/"+e))}},Bn={umpMetadata:function(t,n){return P.umpCustomText(t,0,1,1,0,n)},umpProjectName:function(t,n){return P.umpCustomText(t,0,1,1,1,n)},umpCompositionName:function(t,n){return P.umpCustomText(t,0,1,1,2,n)},umpClipName:function(t,n){return P.umpCustomText(t,0,1,1,3,n)},umpCopyright:function(t,n){return P.umpCustomText(t,0,1,1,4,n)},umpComposerName:function(t,n){return P.umpCustomText(t,0,1,1,5,n)},umpLyricistName:function(t,n){return P.umpCustomText(t,0,1,1,6,n)},umpArrangerName:function(t,n){return P.umpCustomText(t,0,1,1,7,n)},umpPublisherName:function(t,n){return P.umpCustomText(t,0,1,1,8,n)},umpPerformerName:function(t,n){return P.umpCustomText(t,0,1,1,9,n)},umpAccPerformerName:function(t,n){return P.umpCustomText(t,0,1,1,10,n)},umpRecordingDate:function(t,n){return P.umpCustomText(t,0,1,1,11,n)},umpRecordingLocation:function(t,n){return P.umpCustomText(t,0,1,1,12,n)},umpText:function(t,n){return P.umpCustomText(t,0,1,2,0,n)},umpLyrics:function(t,n){return P.umpCustomText(t,0,1,2,1,n)},umpLyricsLanguage:function(t,n){return P.umpCustomText(t,0,1,2,2,n)},umpRuby:function(t,n){return P.umpCustomText(t,0,1,2,3,n)},umpRubyLanguage:function(t,n){return P.umpCustomText(t,0,1,2,4,n)},umpData:function(t,n,e){void 0===e&&(e=n,n=0);for(var r=En(function(t){var n,e=[];if("string"==typeof t)for(n=0;n<t.length;n++)e.push(t.charCodeAt(n));else for(n=0;n<t.length;n++)e.push(t[n]);for(n=0;n<e.length;n++)if(e[n]!=parseInt(e[n])||e[n]<0||255<e[n])throw RangeError("Bad data");return e}(e),13),i=0;i<r.length;i++)r[i]=[80+_(t),16*Fn(r.length,i)+r[i].length,y(n)].concat(r[i],Sn).slice(0,16);return r}},Pn=[0,6,32,38,98,99,100,101],B={umpNoteOn:function(t,n,e,r,i,o){return i=i||0,o=o||0,r=Jt(r=void 0===r?65535:r),o=Jt(o),[64+_(t),144+g(n),b(e),y(i),r>>8,255&r,o>>8,255&o]},umpNoteOff:function(t,n,e,r,i,o){return i=i||0,o=o||0,r=Jt(r=r||0),o=Jt(o),[64+_(t),128+g(n),b(e),y(i),r>>8,255&r,o>>8,255&o]},umpAftertouch:function(t,n,e,r,i,o,s){return[64+_(t),160+g(n),b(e),0].concat(Tn(r,i,o,s))},umpAftertouchF:function(t,n,e,r){return B.umpAftertouch(t,n,e,wn(r))},umpControl:function(t,n,e,r,i,o,s){return Pn.includes(e)&&Ut(e),[64+_(t),176+g(n),v(e),0].concat(Tn(r,i,o,s))},umpPortamento:function(t,n,e){return[64+_(t),176+g(n),84,0,b(e),0,0,0]},umpPressure:function(t,n,e,r,i,o){return[64+_(t),208+g(n),0,0].concat(Tn(e,r,i,o))},umpPressureF:function(t,n,e){return B.umpPressure(t,n,wn(e))},umpProgram:function(t,n,e,r,i){return void 0===r&&void 0===i?[64+_(t),192+g(n),0,0,b(e),0,0,0]:[64+_(t),192+g(n),0,1,b(e),0,b(r),b(i)]},umpPitchBend:function(t,n,e,r,i,o){return[64+_(t),224+g(n),0,0].concat(Tn(e,r,i,o))},umpPitchBendF:function(t,n,e){return B.umpPitchBend(t,n,wn((e+1)/2))},umpPnPitchBend:function(t,n,e,r,i,o,s){return[64+_(t),96+g(n),b(e),0].concat(Tn(r,i,o,s))},umpPnPitchBendF:function(t,n,e,r){return B.umpPnPitchBend(t,n,e,wn((r+1)/2))},umpRPN:function(t,n,e,r,i,o,s,u){return[64+_(t),32+g(n),v(e),v(r)].concat(Tn(i,o,s,u))},umpNRPN:function(t,n,e,r,i,o,s,u){return[64+_(t),48+g(n),v(e),v(r)].concat(Tn(i,o,s,u))},umpPnRPN:function(t,n,e,r,i,o,s,u){return[64+_(t),0+g(n),b(e),y(r)].concat(Tn(i,o,s,u))},umpPnNRPN:function(t,n,e,r,i,o,s,u){return[64+_(t),16+g(n),b(e),y(r)].concat(Tn(i,o,s,u))},umpFineTuning:function(t,n,e,r,i,o){return B.umpRPN(t,n,0,1,e,r,i,o)},umpFineTuningF:function(t,n,e){return B.umpFineTuning(t,n,d.to32b(Ht((e%1+1)/2,e)))},umpCoarseTuning:function(t,n,e){return[64+_(t),32+g(n),0,2,2*v(e),0,0,0]},umpCoarseTuningF:function(t,n,e){return B.umpCoarseTuning(t,n,e-e%1+64)},umpTuningProgram:function(t,n,e){return[64+_(t),32+g(n),0,3,2*v(e),0,0,0]},umpTuningBank:function(t,n,e){return[64+_(t),32+g(n),0,4,2*v(e),0,0,0]},umpPnManagement:function(t,n,e,r){for(var i=r.toString().split(""),o=0,s=0;s<i.length;s++)if("S"!=i[s]||1&o){if("D"!=i[s]||2&o){o=r;break}o|=2}else o|=1;return[64+_(t),240+g(n),b(e),y(o),0,0,0,0]}},P=(B.umpPnPressure=B.umpAftertouch,B.umpPnPressureF=B.umpAftertouchF,B.umpTranspose=B.umpCoarseTuningF,{umpTuningF:function(t,n,e){return[B.umpCoarseTuningF(t,n,e),B.umpFineTuningF(t,n,e)]},umpTuningA:function(t,n,e){return P.umpTuningF(t,n,d.shift(e))},umpCustomText:function(t,n,e,r,i,o){var s,u=[];for(o=p.lib.toUTF8(""+o),s=0;s<o.length;s++)u.push(o.charCodeAt(s));for(u=En(u,12),s=0;s<u.length;s++)u[s]=[208+_(t),64*Fn(u.length,s)+(e?16:0)+g(n),r,i].concat(u[s],Sn).slice(0,16);return u},umpCMetadata:function(t,n,e){return P.umpCustomText(t,n,0,1,0,e)},umpCProjectName:function(t,n,e){return P.umpCustomText(t,n,0,1,1,e)},umpCCompositionName:function(t,n,e){return P.umpCustomText(t,n,0,1,2,e)},umpCClipName:function(t,n,e){return P.umpCustomText(t,n,0,1,3,e)},umpCCopyright:function(t,n,e){return P.umpCustomText(t,n,0,1,4,e)},umpCComposerName:function(t,n,e){return P.umpCustomText(t,n,0,1,5,e)},umpCLyricistName:function(t,n,e){return P.umpCustomText(t,n,0,1,6,e)},umpCArrangerName:function(t,n,e){return P.umpCustomText(t,n,0,1,7,e)},umpCPublisherName:function(t,n,e){return P.umpCustomText(t,n,0,1,8,e)},umpCPerformerName:function(t,n,e){return P.umpCustomText(t,n,0,1,9,e)},umpCAccPerformerName:function(t,n,e){return P.umpCustomText(t,n,0,1,10,e)},umpCRecordingDate:function(t,n,e){return P.umpCustomText(t,n,0,1,11,e)},umpCRecordingLocation:function(t,n,e){return P.umpCustomText(t,n,0,1,12,e)},umpCText:function(t,n,e){return P.umpCustomText(t,n,0,2,0,e)},umpCLyrics:function(t,n,e){return P.umpCustomText(t,n,0,2,1,e)},umpCLyricsLanguage:function(t,n,e){return P.umpCustomText(t,n,0,2,2,e)},umpCRuby:function(t,n,e){return P.umpCustomText(t,n,0,2,3,e)},umpCRubyLanguage:function(t,n,e){return P.umpCustomText(t,n,0,2,4,e)}}),F={};function Fn(t,n){return 1==t?0:0==n?1:n==t-1?3:2}function En(t,n){for(var e=[],r=t;r.length;r=r.slice(n))e.push(r.slice(0,n));return e.length?e:[[]]}function On(t,n){for(var e=En(n.slice(1,n.length-1),6),r=0;r<e.length;r++)e[r]=new A([48+t,16*Fn(e.length,r)+e[r].length].concat(e[r],Sn).slice(0,8));return e}function Nn(t,n){A[t]=function(){var t=Array.prototype.slice.call(arguments);return void 0!==this._gr&&(t=[this._gr].concat(t)),new A([32+_((t=void 0!==this._ch?[t[0]].concat([this._ch]).concat(t.slice(1)):t)[0])].concat(n.apply(this,t.slice(1)),Sn).slice(0,4))},F[t]=function(){var t=Array.prototype.slice.call(arguments);return void 0!==this._gr&&(t=[this._gr].concat(t)),void 0!==this._ch&&(t=[t[0]].concat([this._ch]).concat(t.slice(1))),this.send([32+_(t[0])].concat(n.apply(this,t.slice(1)),Sn).slice(0,4))}}function kn(n){s(F,function(t){n.prototype[t]=F[t]})}function Rn(t,n,e,r){return 16777216*t+65536*n+256*e+r>>25&127}function E(t,n){return t.gr=n,t}function Dn(t){if(t.isMidi2){var n,e,r=t[0]>>4,i=15&t[0];if(1==r||2==r)this._emit(E(new d(t.slice(1)),i));else if(3==r)e=t[1]>>4,n=15&t[1],0==e?(this._emit(E(new d([240].concat(t.slice(2,2+n),[247])),i)),this._sx[i]=void 0):1==e?this._sx[i]=t.slice(2,2+n):2==e?this._sx[i]&&(this._sx[i]=this._sx[i].concat(t.slice(2,2+n))):3==e&&(this._sx[i]&&this._emit(E(new d([240].concat(this._sx[i],t.slice(2,2+n),[247])),i)),this._sx[i]=void 0);else if(4==r){if(n=t[1]>>4,e=15&t[1],2==n||3==n?(this._emit(E(new d([176+e,2==n?101:99,t[2]]),i)),this._emit(E(new d([176+e,2==n?100:98,t[3]]),i)),this._emit(E(new d([176+e,6,t[4]>>1]),i)),this._emit(E(new d([176+e,38,64*(1&t[4])+(t[4]>>2)]),i))):8!=n&&9!=n||this._emit(E(new d([t[1],t[2],(r=t[4],o=t[5],(r=256*r+o)?r>>9||1:0)]),i)),10==n&&this._emit(E(new d([t[1],t[2],Rn(t[4],t[5],t[6],t[7])]),i)),11==n){if(Pn.includes(t[2]))return;this._emit(E(new d([t[1],t[2],Rn(t[4],t[5],t[6],t[7])]),i))}13==n&&this._emit(E(new d([t[1],Rn(t[4],t[5],t[6],t[7])]),i)),14==n?(o=16777216*t[4]+65536*t[5]+256*t[6]+t[4]>>18,this._emit(E(new d([t[1],127&o,o>>7&127]),i))):12==n&&(t[3]&&(this._emit(E(new d([176+e,0,t[6]]),i)),this._emit(E(new d([176+e,32,t[7]]),i))),this._emit(E(new d([t[1],t[4]]),i)))}}else this._emit(t);var o}function Ln(t){if(t.isMidi2)this._emit(t);else{var n=0<=t.gr&&t.gr<=15?t.gr:0;if(128<=t[0]&&t[0]<240)this._emit(p.MIDI2([32+n].concat(t.slice(),Sn).slice(0,4)));else if(240<t[0]&&t[0]<=255&&247!=t[0])this._emit(p.MIDI2([16+n].concat(t.slice(),Sn).slice(0,4)));else if(t.isFullSysEx())for(var e=On(n,t.slice()),r=0;r<e.length;r++)this._emit(p.MIDI2(e[r]))}}s(In,function(t){var n;n=In[t=t],A[t]=function(){return new A(n.apply(this,arguments))},F[t]=function(){return this.send(n.apply(this,arguments))}}),s(An,function(t){var n;n=An[t=t],A[t]=function(){var t=Array.prototype.slice.call(arguments);return void 0!==this._gr&&(t=[this._gr].concat(t)),new A(n.apply(this,t))},F[t]=function(){var t=Array.prototype.slice.call(arguments);return void 0!==this._gr&&(t=[this._gr].concat(t)),this.send(n.apply(this,t))}}),s(Bn,function(t){var r;r=Bn[t=t],A[t]=function(){for(var t=Array.prototype.slice.call(arguments),n=(void 0!==this._gr&&(t=[this._gr].concat(t)),r.apply(this,t)),e=0;e<n.length;e++)n[e]=new A(n[e]);return n},F[t]=function(){for(var t=Array.prototype.slice.call(arguments),n=(void 0!==this._gr&&(t=[this._gr].concat(t)),r.apply(this,t)),e=0;e<n.length;e++)this.send(n[e]);return this}}),s(B,function(t){var n;n=B[t=t],A[t]=function(){var t=Array.prototype.slice.call(arguments);return void 0!==this._gr&&(t=[this._gr].concat(t)),void 0!==this._ch&&(t=[t[0]].concat([this._ch]).concat(t.slice(1))),new A(n.apply(this,t))},F[t]=function(){var t=Array.prototype.slice.call(arguments);return void 0!==this._gr&&(t=[this._gr].concat(t)),void 0!==this._ch&&(t=[t[0]].concat([this._ch]).concat(t.slice(1))),this.send(n.apply(this,t))}}),s(P,function(t){var r;r=P[t=t],A[t]=function(){for(var t=Array.prototype.slice.call(arguments),n=(void 0!==this._gr&&(t=[this._gr].concat(t)),void 0!==this._ch&&(t=[t[0]].concat([this._ch]).concat(t.slice(1))),r.apply(this,t)),e=0;e<n.length;e++)n[e]=new A(n[e]);return n},F[t]=function(){for(var t=Array.prototype.slice.call(arguments),n=(void 0!==this._gr&&(t=[this._gr].concat(t)),void 0!==this._ch&&(t=[t[0]].concat([this._ch]).concat(t.slice(1))),r.apply(this,t)),e=0;e<n.length;e++)this.send(n[e]);return this}}),s(rn,function(t){var n;n=rn[t=t],A[t]=function(){var t=Array.prototype.slice.call(arguments);return new A([16+_((t=void 0!==this._gr?[this._gr].concat(t):t)[0])].concat(n.apply(this,t.slice(1)),Sn).slice(0,4))},F[t]=function(){var t=Array.prototype.slice.call(arguments);return void 0!==this._gr&&(t=[this._gr].concat(t)),this.send([16+_(t[0])].concat(n.apply(this,t.slice(1)),Sn).slice(0,4))}}),s(tn,function(t){Nn(t,tn[t])}),s(x,function(t){Nn(t,x[t])}),s(T,function(t){var i;i=T[t=t],A[t]=function(){for(var t=Array.prototype.slice.call(arguments),n=(void 0!==this._gr&&(t=[this._gr].concat(t)),void 0!==this._ch&&(t=[t[0]].concat([this._ch]).concat(t.slice(1))),i.apply(this,t.slice(1))),e=0;e<n.length;e++)n[e]=new A([32+_(t[0])].concat(n[e],Sn).slice(0,4));return n},F[t]=function(){for(var t=Array.prototype.slice.call(arguments),n=(void 0!==this._gr&&(t=[this._gr].concat(t)),void 0!==this._ch&&(t=[t[0]].concat([this._ch]).concat(t.slice(1))),i.apply(this,t.slice(1))),e=this,r=0;r<n.length;r++)e=e.send([32+_(t[0])].concat(n[r],Sn).slice(0,4));return e}}),s(S,function(t){var i;i=S[t=t],A[t]=function(){var t=Array.prototype.slice.call(arguments);return On(_((t=void 0!==this._gr?[this._gr].concat(t):t)[0]),i.apply(this,t.slice(1)))},F[t]=function(){for(var t=Array.prototype.slice.call(arguments),n=On(_((t=void 0!==this._gr?[this._gr].concat(t):t)[0]),i.apply(this,t.slice(1))),e=this,r=0;r<n.length;r++)e=e.send(n[r]);return e}}),s(on,function(t){var s;s=on[t=t],A[t]=function(){for(var t=Array.prototype.slice.call(arguments),n=(void 0!==this._gr&&(t=[this._gr].concat(t)),s.apply(this,t.slice(1))),e=[],r=0;r<n.length;r++)e=e.concat(On(_(t[0]),n[r]));return e},F[t]=function(){for(var t=Array.prototype.slice.call(arguments),n=(void 0!==this._gr&&(t=[this._gr].concat(t)),s.apply(this,t.slice(1))),e=this,r=0;r<n.length;r++)for(var i=On(_(t[0]),n[r]),o=0;o<i.length;o++)e=e.send(i[o]);return e}}),kn(h),A.prototype.getTempo=function(){if(this.isTempo())return(this[4]<<24)+(this[5]<<16)+(this[6]<<8)+this[7]},A.prototype.getBPM=function(){var t=this.getTempo();if(t)return Math.round(6e9/t)},A.prototype.getTimeSignature=function(){if(this.isTimeSignature())return[this[4],1<<this[5]]},A.prototype.getTicksPQN=function(){if(this.isTicksPQN())return(this[2]<<8)+this[3]},A.prototype.getDelta=function(){if(this.isDelta())return((15&this[1])<<16)+(this[2]<<8)+this[3]},A.prototype.isTempo=function(){return this[0]>>4==13&&this[1]>>4==1&&0==this[2]&&0==this[3]},A.prototype.isTimeSignature=function(){return this[0]>>4==13&&this[1]>>4==1&&0==this[2]&&1==this[3]},A.prototype.isTicksPQN=function(){return 0==this[0]&&this[1]>>4==3},A.prototype.isDelta=function(){return 0==this[0]&&this[1]>>4==4},A.prototype.isStartClip=function(){return this.match([240,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0])},A.prototype.isEndClip=function(){return this.match([240,33,0,0,0,0,0,0,0,0,0,0,0,0,0,0])},A.prototype.isNoteOn=function(){var t=(this[0]||0)>>4,n=(this[1]||0)>>4;return 4==t?9==n:2==t&&(9==n&&!!this[3])},A.prototype.isNoteOff=function(){var t=(this[0]||0)>>4,n=(this[1]||0)>>4;return 4==t?8==n:2==t&&(8==n||9==n&&!this[3])},A.prototype.toString=d.prototype.toString,A.prototype._str=function(){var t=this._string();return t?mn(this)+" -- "+t:mn(this)},A.prototype._string=function(){var t,n,e,r=this[0]>>4;return 1==r||2==r?new d(this.slice(1))._string():(0==r?n=["NOOP","JR Clock","JR Timestamp","Ticks Per Quarter Note","Delta Ticks"][t=this[1]>>4]:3==r?n="SysEx":4==r?(n={0:"Registered Per-Note Controller",1:"Assignable Per-Note Controller",2:"Registered Controller",3:"Assignable Controller",4:"Relative Registered Controller",5:"Relative Assignable Controller",6:"Per-Note Pitch Bend",8:"Note Off",9:"Note On",10:"Poly Pressure",11:"Control Change",12:"Program Change",13:"Channel Pressure",14:"Pitch Bend",15:"Per-Note Management"}[t=this[1]>>4],11==t&&(n={84:"Portamento"}[this[2]]||n),2==t&&(e={"0000":"Pitch Bend Sensitivity","0001":"Fine Tuning","0002":"Coarse Tuning","0003":"Select Tuning Program","0004":"Select Tuning Bank","0005":"Vibrato Depth Range","7f7f":"NONE"}[I(this[2])+""+I(this[3])])&&(n+=": "+e)):5==r?n="Data":13==r&&(0==(t=this[2])?(n={0:"Tempo ",1:"Time Signature ",2:"Metronome",5:"Key Signature",6:"Chord Name"}[t=this[3]],0==t?n+=this.getBPM()+" BPM":1==t&&(n+=this.getTimeSignature().join("/"))):1==t?n={0:"Metadata",1:"Project Name",2:"Composition Name",3:"Clip Name",4:"Copyright",5:"Composer Name",6:"Lyricist Name",7:"Arranger Name",8:"Publisher Name",9:"Primary Performer Name",10:"Accompanying Performer Name",11:"Recording Date",12:"Recording Location"}[t=this[3]]||"Unknown Text":2==t&&(n={0:"Text",1:"Lyrics",2:"Lyrics Language",3:"Ruby",4:"Ruby Language"}[t=this[3]]||"Unknown Text")),15==r?{32:"Start of Clip",33:"End of Clip"}[this[1]]:n)},A.prototype._stamp=d.prototype._stamp,A.prototype._unstamp=d.prototype._unstamp,A.prototype._stamped=d.prototype._stamped,A.prototype.match=d.prototype.match,p.UMP=A,p.MIDI2=r.prototype.UMP=A,r.prototype.MIDI2=A,p.M2M1=function(){var t=new c;return t._sx=[],t._receive=Dn,t._resume(),t.MIDI2()},r.prototype.M2M1=p.M2M1,p.M1M2=function(){var t=new c;return t._receive=Ln,t._resume(),t},r.prototype.M1M2=p.M1M2,p.lib={},p.lib.now=z,p.lib.schedule=V;var qn,O,Gn=[],jn=0;try{function zn(){for(var t=Gn.length,n=0;n<t;n++)Gn.shift()();20<++jn&&qn&&(qn.terminate(),qn=void 0)}function Vn(t){Gn.push(t),jn=0,qn||((qn=new Worker(Un)).onmessage=zn)}var Un=URL.createObjectURL(new Blob(["(",function(){!function t(){postMessage({}),setTimeout(t,0)}()}.toString(),")()"],{type:"application/javascript"}));Vn(function(){p.lib.schedule=Vn})}catch(t){}p.lib.openMidiOut=function(t,n){var e=new c;return n._openOut(e),e._info=n._info(t),e},p.lib.openMidiIn=function(t,n){var e=new c;return n._openIn(e),e._info=n._info(t),e},p.lib.registerMidiOut=function(t,n){for(var e=n._info(t),r=0;r<wt._outs.length;r++)if(wt._outs[r].name==e.name)return!1;return e.engine=n,wt._outs.push(e),u&&(ut(),u._bad&&(u._repair(),u._resume())),!0},p.lib.registerMidiIn=function(t,n){for(var e=n._info(t),r=0;r<wt._ins.length;r++)if(wt._ins[r].name==e.name)return!1;return e.engine=n,wt._ins.push(e),u&&(ut(),u._bad&&(u._repair(),u._resume())),!0},p.lib.copyMidiHelpers=cn,p.lib.copyMidi2Helpers=kn,p.lib.copyUmpHelpers=kn,p.lib.getAudioContext=function(){var t,e;return O||"undefined"==typeof window||(t=window.AudioContext||window.webkitAudioContext)&&((O=new t)&&!O.createGain&&(O.createGain=O.createGainNode),e=function(){if("running"!=O.state){O.resume();var t=O.createOscillator(),n=O.createGain();try{n.gain.value=0}catch(t){}n.gain.setTargetAtTime(0,O.currentTime,.01),t.connect(n),n.connect(O.destination),t.start||(t.start=t.noteOn),t.stop||(t.stop=t.noteOff),t.start(.1),t.stop(.11)}else"undefined"!=typeof document&&(document.removeEventListener("touchstart",e),document.removeEventListener("touchend",e),document.removeEventListener("mousedown",e),document.removeEventListener("keydown",e))},"undefined"!=typeof document&&(document.addEventListener("touchstart",e),document.addEventListener("touchend",e),document.addEventListener("mousedown",e),document.addEventListener("keydown",e)),e()),O};var Wn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",N=(p.lib.fromBase64=function(t){var n,e,r,i,o,s,u="",a=0;for(t=t.replace(/[^A-Za-z0-9+/=]/g,"");a<t.length;)r=Wn.indexOf(t.charAt(a++)),n=(15&(i=Wn.indexOf(t.charAt(a++))))<<4|(o=Wn.indexOf(t.charAt(a++)))>>2,e=(3&o)<<6|(s=Wn.indexOf(t.charAt(a++))),u+=String.fromCharCode(r<<2|i>>4),64!=o&&(u+=String.fromCharCode(n)),64!=s&&(u+=String.fromCharCode(e));return u},p.lib.toBase64=function(t){var n,e,r,i,o=0,s=0,u="",a=[];if(!t)return t;for(;n=(i=t.charCodeAt(o++)<<16|t.charCodeAt(o++)<<8|t.charCodeAt(o++))>>12&63,e=i>>6&63,r=63&i,a[s++]=Wn.charAt(i>>18&63)+Wn.charAt(n)+Wn.charAt(e)+Wn.charAt(r),o<t.length;);var u=a.join(""),c=t.length%3;return c?u.slice(0,c-3)+"===".slice(c):u},p.lib.fromUTF8=function(t){t=void 0===t?"":""+t;for(var n,e,r="",i=0;i<t.length;i++){if(255<(n=t.charCodeAt(i)))return t;if(n<128)r+=t[i];else if(192==(224&n)){if(n=(31&n)<<6,++i>=t.length)return t;if(128!=(192&(e=t.charCodeAt(i))))return t;n+=63&e,r+=String.fromCharCode(n)}else if(224==(240&n)){if(n=(15&n)<<12,++i>=t.length)return t;if(128!=(192&(e=t.charCodeAt(i))))return t;if(n+=(63&e)<<6,++i>=t.length)return t;if(128!=(192&(e=t.charCodeAt(i))))return t;n+=63&e,r+=String.fromCharCode(n)}else if(240==(248&n)){if(n=(7&n)<<18,++i>=t.length)return t;if(128!=(192&(e=t.charCodeAt(i))))return t;if(n+=(63&e)<<12,++i>=t.length)return t;if(128!=(192&(e=t.charCodeAt(i))))return t;if(n+=(63&e)<<6,++i>=t.length)return t;if(128!=(192&(e=t.charCodeAt(i))))return t;if(1114111<(n+=63&e))return t;n-=65536,r=(r+=String.fromCharCode(55296+(n>>10)))+String.fromCharCode(56320+(1023&n))}}return r},p.lib.toUTF8=function(t){t=void 0===t?"":""+t;for(var n,e="",r=0;r<t.length;r++)(n=t.charCodeAt(r))<128?e+=t[r]:e=n<2048?(e+=String.fromCharCode(192+(n>>6)))+String.fromCharCode(128+(63&n)):n<65536?(e=(e+=String.fromCharCode(224+(n>>12)))+String.fromCharCode(128+(n>>6&63)))+String.fromCharCode(128+(63&n)):(e=(e=(e+=String.fromCharCode(240+(n>>18)))+String.fromCharCode(128+(n>>12&63)))+String.fromCharCode(128+(n>>6&63)))+String.fromCharCode(128+(63&n));return e},[]),k={},R={},Zn=t.Promise;function Jn(t,n,e){this.name=t,this.message=n,this.code=e}function Xn(t,n){this.bubbles=!1,this.cancelBubble=!1,this.cancelable=!1,this.currentTarget=n,this.defaultPrevented=!1,this.eventPhase=0,this.path=[],this.port=t,this.returnValue=!0,this.srcElement=n,this.target=n,this.timeStamp=z(),this.type="statechange"}function Hn(t,n){this.bubbles=!1,this.cancelBubble=!1,this.cancelable=!1,this.currentTarget=t,this.data=n,this.defaultPrevented=!1,this.eventPhase=0,this.path=[],this.receivedTime=z(),this.returnValue=!0,this.srcElement=t,this.target=t,this.timeStamp=this.receivedTime,this.type="midimessage"}function Qn(t,n){t&&(t.onstatechange&&t.onstatechange(new Xn(t,t)),n.onstatechange&&n.onstatechange(new Xn(t,n)))}function Kn(e,r){var i=this,o=!1,n=null,s=null;this.type="input",this.id=r.id,this.name=r.name,this.manufacturer=r.man,this.version=r.ver,Object.defineProperty(this,"state",{get:function(){return r.connected?"connected":"disconnected"},enumerable:!0}),Object.defineProperty(this,"connection",{get:function(){return o?r.proxy?"open":"pending":"closed"},enumerable:!0}),Object.defineProperty(this,"onmidimessage",{get:function(){return s},set:function(t){a(t)?(s=t,o||i.open().then(U,U)):s=null},enumerable:!0}),Object.defineProperty(this,"onstatechange",{get:function(){return n},set:function(t){n=a(t)?t:null},enumerable:!0}),this.open=function(){return new Zn(function(t,n){o?t(i):r.open().then(function(){o||(o=!0,Qn(i,e)),t(i)},function(){n(new Jn("InvalidAccessError","Port is not available",15))})})},this.close=function(){return new Zn(function(t){o&&(o=!1,r.close(),Qn(i,e)),t(i)})},Object.freeze(this)}function Yn(t){for(var n,e;t.length;){for(n=0;n<t.length&&!(t[n]==parseInt(t[n])&&128<=t[n]&&t[n]<=255&&247!=t[n]);n++);if(t.splice(0,n),!t.length)return;if(240==t[0]){for(n=1;n<t.length&&247!=t[n];n++);return n==t.length?void 0:t.splice(0,n+1)}if((e=te(t[0])+1)>t.length)return;for(n=1;n<e&&!(t[n]!=parseInt(t[n])||t[n]<0||128<=t[n]);n++);if(n==e)return t.splice(0,n);t.splice(0,n)}}function $n(t,n,e,r){var i=this;this.id=t,this.name=n,this.man=e,this.ver=r,this.connected=!0,this.ports=[],this.pending=[],this.proxy=void 0,this.queue=[],this.onmidi=function(t){var n;for(i.queue=i.queue.concat(t.slice()),n=Yn(i.queue);n;n=Yn(i.queue))for(D=0;D<i.ports.length;D++)i.ports[D][0].onmidimessage&&(240!=n[0]||i.ports[D][1])&&i.ports[D][0].onmidimessage(new Hn(i,new Uint8Array(n)))}}function te(t){return 128<=t&&t<=191||224<=t&&t<=239||242==t?2:192<=t&&t<=223||241==t||243==t?1:0}"function"!=typeof Zn&&((Zn=function(t){this.executor=t}).prototype.then=function(t,n){this.executor(t="function"!=typeof t?U:t,n="function"!=typeof n?U:n)}),$n.prototype.open=function(){var r=this;return new Zn(function(t,n){var e;r.proxy||!r.connected?t():(r.pending.push([t,n]),1==r.pending.length&&p().openMidiIn(r.name).or(function(){for(e=0;e<r.pending.length;e++)r.pending[e][1]();r.pending=[]}).and(function(){for(r.proxy=this,r.proxy.connect(r.onmidi),e=0;e<r.pending.length;e++)r.pending[e][0]();r.pending=[]}))})},$n.prototype.close=function(){var t;if(this.proxy){for(t=0;t<this.ports.length;t++)if("open"==this.ports[t].connection)return;this.proxy.close(),this.proxy=void 0}},$n.prototype.disconnect=function(){this.connected=!1,this.proxy&&(this.proxy.close(),this.proxy=void 0)},$n.prototype.reconnect=function(){var t,n,e=this,r=[];for(this.connected=!0,t=0;t<N.length;t++)"closed"==(n=N[t].inputs.get(this.id)).connection?Qn(n,N[t]):r.push([n,N[t]]);r.length&&p()._openMidiInNR(e.name).or(function(){for(t=0;t<r.length;t++)r[t][0].close()}).and(function(){for(e.proxy=this,e.proxy.connect(e.onmidi),t=0;t<r.length;t++)Qn(r[t][0],r[t][1])})};var ne="Failed to execute 'send' on 'MIDIOutput': ";function ee(c,h){var f=this,p=!1,n=null;this.type="output",this.id=h.id,this.name=h.name,this.manufacturer=h.man,this.version=h.ver,Object.defineProperty(this,"state",{get:function(){return h.connected?"connected":"disconnected"},enumerable:!0}),Object.defineProperty(this,"connection",{get:function(){return p?h.proxy?"open":"pending":"closed"},enumerable:!0}),Object.defineProperty(this,"onstatechange",{get:function(){return n},set:function(t){n=a(t)?t:null},enumerable:!0}),this.open=function(){return new Zn(function(t,n){p?t(f):h.open().then(function(){p||(p=!0,Qn(f,c)),t(f)},function(){n(new Jn("InvalidAccessError","Port is not available",15))})})},this.close=function(){return new Zn(function(t){p&&(p=!1,f.clear(),h.close(),Qn(f,c)),t(f)})},this.clear=function(){},this.send=function(t,n){for(var e,r,i,o=t,s=c.sysexEnabled,u=[],a=0;a<o.length;a++)if(o[a]!=parseInt(o[a])||o[a]<0||255<o[a])throw TypeError(ne+o[a]+" is not a UInt8 value.");for(a=e=0;a<o.length;a++)if(e){if(127<o[a])throw TypeError(ne+"Unexpected status byte at index "+a+" ("+o[a]+").");r.push(o[a]),e--}else{if(o[a]<128)throw TypeError(ne+"Running status is not allowed at index "+a+" ("+o[a]+").");if(247==o[a])throw TypeError(ne+"Unexpected end of system exclusive message at index "+a+" ("+o[a]+").");if(r=[o[a]],u.push(r),240==o[a]){if(!s)throw new Jn("InvalidAccessError",ne+"System exclusive messag is not allowed at index "+a+" ("+o[a]+").",15);for(e=-1;a<o.length;a++)if(r.push(o[a]),247==o[a]){e=0;break}}else e=te(o[a])}if(e)throw TypeError(ne+"Message is incomplete");if(!h.connected)throw new Jn("InvalidStateError","Port is not connected",11);p?(i=z())<n?setTimeout(function(){h.proxy.send(t)},n-i):h.proxy.send(t):this.open().then(function(){f.send(t,n)},U)},Object.freeze(this)}function re(t,n,e,r){this.id=t,this.name=n,this.man=e,this.ver=r,this.connected=!0,this.ports=[],this.pending=[],this.proxy=void 0}function ie(r){this.has=function(t){return r.hasOwnProperty(t)&&r[t].connected},this.keys=function(){try{var t,n=new Map;for(t in r)this.has(t)&&n.set(t,this.get(t));return n.keys()}catch(t){}},this.values=function(){try{var t,n=new Map;for(t in r)this.has(t)&&n.set(t,this.get(t));return n.values()}catch(t){}},this.entries=function(){try{var t,n=new Map;for(t in r)this.has(t)&&n.set(t,this.get(t));return n.entries()}catch(t){}},this.forEach=function(t,n){for(var e in void 0===n&&(n=this),r)this.has(e)&&t.call(n,this.get(e),e,this)},Object.defineProperty(this,"size",{get:function(){var t,n=0;for(t in r)this.has(t)&&n++;return n},enumerable:!0})}function oe(n,e){this.get=function(t){if(R.hasOwnProperty(t)&&R[t].connected)return e[t]||(e[t]=new Kn(n,R[t]),R[t].ports.push([e[t],n.sysexEnabled])),e[t]},Object.freeze(this)}function se(n,e){this.get=function(t){if(k.hasOwnProperty(t)&&k[t].connected)return e[t]||(e[t]=new ee(n,k[t]),k[t].ports.push([e[t],n.sysexEnabled])),e[t]},Object.freeze(this)}function ue(t){for(var n,e,r,i=0;i<t.inputs.added.length;i++)e=t.inputs.added[i],R.hasOwnProperty(e.id)||(R[e.id]=new $n(e.id,e.name,e.manufacturer,e.version)),R[e.id].reconnect();for(i=0;i<t.outputs.added.length;i++)e=t.outputs.added[i],k.hasOwnProperty(e.id)||(k[e.id]=new re(e.id,e.name,e.manufacturer,e.version)),k[e.id].reconnect();for(i=0;i<t.inputs.removed.length;i++)if(e=t.inputs.removed[i],R.hasOwnProperty(e.id)){for(r=[],n=0;n<N.length;n++)r.push([N[n].inputs.get(e.id),N[n]]);for(R[e.id].disconnect(),n=0;n<r.length;n++)Qn(r[n][0],r[n][1])}for(i=0;i<t.outputs.removed.length;i++)if(e=t.outputs.removed[i],k.hasOwnProperty(e.id)){for(r=[],n=0;n<N.length;n++)r.push([N[n].outputs.get(e.id),N[n]]);for(k[e.id].disconnect(),n=0;n<r.length;n++)Qn(r[n][0],r[n][1])}}function ae(t){for(var n,e=null,r=(this.sysexEnabled=t,this.inputs=new oe(this,{}),this.outputs=new se(this,{}),Object.defineProperty(this,"onstatechange",{get:function(){return e},set:function(t){e=a(t)?t:null},enumerable:!0}),Object.freeze(this),u._info),i=0;i<r.inputs.length;i++)n=r.inputs[i],R.hasOwnProperty(n.id)||(R[n.id]=new $n(n.id,n.name,n.manufacturer,n.version));for(i=0;i<r.outputs.length;i++)n=r.outputs[i],k.hasOwnProperty(n.id)||(k[n.id]=new re(n.id,n.name,n.manufacturer,n.version));N.length||p().onChange(ue),N.push(this)}return re.prototype.open=function(){var r=this;return new Zn(function(t,n){var e;r.proxy||!r.connected?t():(r.pending.push([t,n]),1==r.pending.length&&p().openMidiOut(r.name).or(function(){for(e=0;e<r.pending.length;e++)r.pending[e][1]();r.pending=[]}).and(function(){for(r.proxy=this,e=0;e<r.pending.length;e++)r.pending[e][0]();r.pending=[]}))})},re.prototype.close=function(){var t;if(this.proxy){for(t=0;t<this.ports.length;t++)if("open"==this.ports[t].connection)return;this.proxy.close(),this.proxy=void 0}},re.prototype.disconnect=function(){this.connected=!1,this.proxy&&(this.proxy.close(),this.proxy=void 0)},re.prototype.reconnect=function(){var t,n,e=this,r=[];for(this.connected=!0,t=0;t<N.length;t++)"closed"==(n=N[t].outputs.get(this.id)).connection?Qn(n,N[t]):r.push([n,N[t]]);r.length&&p()._openMidiOutNR(e.name).or(function(){for(t=0;t<r.length;t++)r[t][0].close()}).and(function(){for(e.proxy=this,t=0;t<r.length;t++)Qn(r[t][0],r[t][1])})},(oe.prototype=new ie(R)).constructor=oe,(se.prototype=new ie(k)).constructor=se,p.requestMIDIAccess=function(r){return new Zn(function(n,e){p.JZZ(r).or(function(){}).and(function(){var t=!(!r||!r.sysex);t&&!this.info().sysex?e(new Jn("SecurityError","Sysex is not allowed",18)):(t=new ae(t),n(t))})})},"undefined"==typeof navigator||navigator.requestMIDIAccess||(navigator.requestMIDIAccess=p.requestMIDIAccess),p.close=function(){f._close&&f._close()},p});